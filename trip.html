<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>Income & Expense Tracker</title>
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
Â  Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="bg-gray-100">
Â 
Â <div id="loader" class="fixed inset-0 bg-white bg-opacity-40 backdrop-blur-sm z-50 flex flex-col items-center justify-center pointer-events-auto">
Â  <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
Â  <p class="mt-4 text-gray-800 font-semibold">Loading... Please Wait</p>
</div>

Â 

Â <navÂ  class="bg-white shadow p-4 flex justify-between items-center">
Â  <div class="text-2xl font-bold text-black-400">My Personal Website</div>
Â Â 
Â  <div class="flex space-x-6 text-gray-700 text-lg">
Â  <a href="home.html" class="flex items-center gap-2"><i class="fas fa-house"></i> Home</a>

<a href="income.html" class="flex items-center gap-2"><i class="fas fa-wallet"></i> Income</a>
<a href="links.html" class="flex items-center gap-2"><i class="fas fa-link"></i> Links</a>
Â <a href="calender.html" class="flex items-center gap-2"><i class="fas fa-calendar-days"></i> Calendar</a>
<a href="birthday.html" class="flex items-center gap-2"><i class="fas fa-cake-candles"></i> Birthday</a>
<a href="password.html" class="flex items-center gap-2"><i class="fas fa-lock"></i> Passwords</a>
Â  </div>


Â  <div class="flex items-center space-x-3">
Â  Â  <div class="text-right">
Â  Â  Â  <p id="userName" class="font-medium text-black text-sm">User Name</p>
Â  Â  Â  <p id="userEmail" class="text-xs text-gray-600">user@example.com</p>
Â  Â  Â  <p id="userId" class="text-xs text-gray-400 hidden">UID here</p>
Â  Â  </div>
Â  Â <img id="userPic" src="" alt="User Photo" width="40" style="border-radius: 50%;" />
<button id="logoutBtn" style="background-color: #dc2626; color: white; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer;">
Â  Logout
</button>
Â  </div>
</nav>

<div class="max-w-8xl mx-auto p-3">
Â  Â  <div class="flex justify-center mb-6">
Â  Â  <input type="month" id="monthSelector" class="border p-2 rounded w-60" />
Â  </div>

Â  Â  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2 mb-6">
Â  Â  <div class="bg-white p-3 shadow rounded text-center">
Â  Â  Â  <h2 class="text-sm text-gray-600">This Month's Income</h2>
Â  Â  Â  <input type="number" id="incomeInput" class="mt-2 border rounded w-full text-center p-1" placeholder="Enter Income" />
Â  Â  Â  <div class="text-xl font-bold mt-2" id="incomeDisplay">â‚¹0</div>
Â  Â  Â  <button onclick="saveIncomeData()" class="mt-3 bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 text-sm">Save</button>
Â  Â  </div>
Â  Â  <div class="bg-white p-1 shadow rounded text-center">
Â  Â  Â  <h2 class="text-sm text-gray-600">This Month's Expense</h2>
Â  Â  Â  <div class="text-xl font-bold" id="monthExpense">â‚¹0</div>
Â  Â  </div>
Â  Â  <div class="bg-white p-2 shadow rounded text-center">
Â  Â  Â  <h2 class="text-sm text-gray-600">This Month's Saving</h2>
Â  Â  Â  <div class="text-xl font-bold" id="monthSaving">â‚¹0</div>
Â  Â  </div>
Â  Â  <div class="bg-white p-2 shadow rounded text-center">
Â  Â  Â  <h2 class="text-sm text-gray-600">Overall Saving</h2>
Â  Â  Â  <div class="text-xl font-bold" id="overallSaving">â‚¹0</div>
Â  Â  </div>
Â  </div>

Â <div class="bg-white p-4 rounded shadow mb-4">
Â  <h2 class="text-lg font-semibold mb-2">Add Expense</h2>
Â  Â  <div class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end"> 
Â  Â  <input type="text" id="expenseName" placeholder="Expense Name" class="border p-2 rounded" />
Â  Â  <input type="number" id="expenseAmount" placeholder="Amount" class="border p-2 rounded" />
Â  Â Â 
Â  Â  Â  Â  <input type="text" id="detailsInput" placeholder="Specific Details" class="border p-2 rounded md:col-span-2" />
Â  Â  Â  Â <select id="expenseType" class="border p-2 rounded">
Â  Â  <option value="">-- Select Expense Type --</option>
Â  Â  <option value="Food">Food</option>
Â  Â  <option value="Clothes">Clothes</option>
Â  Â  <option value="Medicine">Medicine</option>
Â  Â  <option value="Necessity">Necessity</option>
Â  Â  <option value="Grocery">Grocery</option>
Â  Â  <option value="Home Maintenance">Home Maintenance (Rent)</option>
Â  Â  <option value="TV/OTT Recharge">TV/OTT Recharge</option>
Â  Â  <option value="School/College Fee">School/College Fee</option>
Â  Â  <option value="Mobile Recharge">Mobile Recharge</option>
Â  Â  <option value="Gas">Gas</option>
Â  Â  <option value="Car/Bike Repair">Car/Bike Repair</option>
Â  Â  <option value="Entertainment">Entertainment</option>
Â  Â  <option value="Travel">Travel</option>
Â  Â  <option value="Dining Out">Dining Out</option>
Â  Â  <option value="Gym/Fitness">Gym/Fitness</option>
Â  Â  <option value="Insurance">Insurance</option>
Â  Â  <option value="Electronics">Electronics</option>
Â  Â  <option value="Gifts">Gifts</option>
Â  Â  <option value="Miscellaneous">Miscellaneous</option>
Â  </select>


Â  Â  <button onclick="addExpense()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add</button>
Â  </div>
</div>

<div class="bg-white p-4 rounded shadow mb-4">
Â  <h2 class="text-lg font-semibold mb-2">Expenses</h2>
Â  <input type="text" id="searchInput" placeholder="Search..." class="border p-2 mb-4 w-full" oninput="filterTable()" />
Â  <table class="table-auto w-full text-center">
Â  Â  <thead class="bg-gray-200">
Â  Â  Â  <tr>
Â  Â  Â  Â  <th class="p-2">#</th>
Â  Â  Â  Â  <th class="p-2">Name Of The Product</th>
Â  Â  Â  Â  <th class="p-2">Amount</th>
Â  Â  Â  Â  <th class="p-2">Type</th> 
Â  Â  Â  Â  <th class="p-2">Details</th> Â  Â  Â  Â  <th class="p-2">Date</th>
Â  Â  Â  Â  <th class="p-2">Actions</th>
Â  Â  Â  </tr>
Â  Â  </thead>
Â  Â  <tbody id="expenseTable"></tbody>
Â  </table>
</div>

Â  <div class="text-center my-6">
Â  <button onclick="printAllExpenses()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
Â  Â  ğŸ–¨ï¸ Print All Expenses
Â  </button>
</div>






<style>
Â  body {
Â  Â  color: #000;
Â  Â  background-color: #fff;
Â  Â  transition: background 0.3s, color 0.3s;
Â  }

Â  .dark-mode {
Â  Â  background-color: #121212;
Â  Â  color: #ccc;
Â  }

Â  .dark-mode *,

Â 
Â  .dark-mode .card,
Â  .dark-mode .box,
Â  .dark-mode .container,
Â  .dark-mode .section,
Â  .dark-mode .modal,

Â  .dark-mode .footer {
Â  Â  background-color: #1e1e1e !important;
Â  Â  color: #ccc !important;
Â  Â  border: 1px solid #444 !important; /* ğŸ”² Clear visible border */
Â  }


Â  .dark-mode a {
Â  Â  color: #90cdf4 !important;
Â  }

Â 



Â  .dark-mode .popup {
Â  Â  box-shadow: 0 0 5px #333;
Â  }
</style>
<style>
Â  body {
Â  Â  background-color: #fff;
Â  Â  color: #000;
Â  Â  transition: background 0.3s, color 0.3s;
Â  }

Â  .dark-mode {
Â  Â  background-color: #121212;
Â  Â  color: #e0e0e0;
Â  }






Â  .dark-mode a {
Â  Â  color: #90cdf4;
Â  }


</style>






Â <style>
Â  Â  /* Basic Reset */
Â  Â  * {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  /* Fullscreen loader */
Â  Â  #loader {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background-color: white;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  z-index: 9999;
Â  Â  }

Â  Â  /* Circular animation */
Â  Â  .spinner {
Â  Â  Â  border: 8px solid #f3f3f3;
Â  Â  Â  border-top: 8px solid #3498db;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 60px;
Â  Â  Â  height: 60px;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  }

Â  Â  @keyframes spin {
Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  }

Â  Â  /* Hide main content initially */
Â  Â  #main-content {
Â  Â  Â  display: none;
Â  Â  }
Â  Â  #expenseName{
Â padding: 20px;
Â height: 25px;
Â margin-right: 20px;
Â  Â  }
</style>
Â  Â <script>
Â  Â  window.addEventListener('load', () => {
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  document.getElementById('loader').style.display = 'none';
Â  Â  Â  Â  document.getElementById('main-content').style.display = 'block';
Â  Â  Â  }, 4000); // 9 seconds
Â  Â  });

Â  </script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>



<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>


<script>
Â  const firebaseConfig = {
Â  Â  apiKey: "AIzaSyB78RTVCg0cmSPp7A1RJyyAgBuCeolO0cc",
Â  Â  authDomain: "sk12-58e9e.firebaseapp.com",
Â  Â  databaseURL: "https://sk12-58e9e-default-rtdb.firebaseio.com",
Â  Â  projectId: "sk12-58e9e",
Â  Â  storageBucket: "sk12-58e9e.appspot.com",
Â  Â  messagingSenderId: "470207874652",
Â  Â  appId: "1:470207874652:web:67ba1cf3629b7e5b144899"
Â  };

Â  if (!firebase.apps.length) {
Â  Â  firebase.initializeApp(firebaseConfig);
Â  }

Â  const auth = firebase.auth();
Â  const db = firebase.database();

Â  let currentUID = null;

Â  async function printAllExpenses() {
Â  Â  if (!currentUID) {
Â  Â  Â  alert("User not logged in");
Â  Â  Â  return;
Â  Â  }

Â  Â  const snapshot = await db.ref(`users/${currentUID}/expenses`).once('value');
Â  Â  if (!snapshot.exists()) {
Â  Â  Â  alert("No expenses found.");
Â  Â  Â  return;
Â  Â  }


Â  let html = `
Â  <html>
Â  <head>
Â  Â  <title>All Expenses</title>
Â  Â  <style>
Â  Â  Â  body {
Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  background-color: #f9f9f9;
Â  Â  Â  }
Â  Â  Â  .receipt-container {
Â  Â  Â  Â  max-width: 800px;
Â  Â  Â  Â  margin: auto;
Â  Â  Â  Â  border: 3px solid black; /* Receipt border */
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  background-color: white;
Â  Â  Â  }
Â  Â  Â  h2 {
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  }
Â  Â  Â  .month {
Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  }
Â  Â  Â  table {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  }
Â  Â  Â  th, td {
Â  Â  Â  Â  border: 1px solid black; /* Cell borders */
Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  text-align: left;
Â  Â  Â  }
Â  Â  Â  th {
Â  Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  }
Â  Â  </style>
Â  </head>
Â  <body>
Â  Â  <div class="receipt-container">
Â  Â  Â  <h2>All Expenses Report</h2>
`;


Â  Â  snapshot.forEach(monthSnap => {
Â  Â  Â  const month = monthSnap.key;
Â  Â  Â  const expenses = monthSnap.val();
Â  Â  Â  html += `<div style="margin-top:20px; font-weight:bold; font-size:18px;">${month}</div>`;
Â  Â  Â  html += `<table border="1" cellpadding="8" cellspacing="0" width="100%" style="margin-top:10px; border-collapse:collapse;">
Â  Â  Â  Â  <tr style="background-color:#f0f0f0;"><th>#</th><th>Name</th><th>Amount (â‚¹)</th><th>Date</th></tr>`;
Â  Â  Â  let count = 1;
Â  Â  Â  for (const id in expenses) {
Â  Â  Â  Â  const exp = expenses[id];
Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td>${count++}</td>
Â  Â  Â  Â  Â  Â  <td>${exp.name || ''}</td>
Â  Â  Â  Â  Â  Â  <td>${exp.amount || ''}</td>
Â  Â  Â  Â  Â  Â  <td>${exp.date || ''}</td>
Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  }
Â  Â  Â  html += `</table>`;
Â  Â  });

Â  Â  document.body.innerHTML = html;
Â  Â  window.print();
Â  Â  location.reload(); // Reload after printing to restore page
Â  }

Â  auth.onAuthStateChanged(user => {
Â  Â  if (!user) return (location.href = "index.html");

Â  Â  currentUID = user.uid;

Â  Â  document.getElementById("userPic").src = user.photoURL || "";
Â  Â  document.getElementById("userName").textContent = user.displayName || "No Name";
Â  Â  document.getElementById("userEmail").textContent = user.email;
Â  Â  document.getElementById("userId").textContent = user.uid;

Â  Â  loadData();
Â  });

Â  function getSelectedMonth() {
Â  Â  return document.getElementById("monthSelector").value || null;
Â  }

Â  async function saveIncomeData() {
Â  Â  const month = getSelectedMonth();
Â  Â  const income = parseFloat(document.getElementById("incomeInput").value);
Â  Â  if (!month || isNaN(income)) return alert("Enter valid month and income");

Â  Â  await db.ref(`users/${currentUID}/income/${month}`).set(income);
Â  Â  loadData();
Â  }

Â  // ğŸ›‘ Removed old addExpense function here

Â  async function loadData() {
Â  Â  const month = getSelectedMonth();
Â  Â  if (!month || !currentUID) return;

Â  Â  const incomeSnap = await db.ref(`users/${currentUID}/income/${month}`).get();
Â  Â  const income = incomeSnap.exists() ? incomeSnap.val() : 0;
Â  Â  document.getElementById("incomeDisplay").textContent = `â‚¹${income}`;

Â  Â  const expenseSnap = await db.ref(`users/${currentUID}/expenses/${month}`).get();
Â  Â  const table = document.getElementById("expenseTable");
Â  Â  table.innerHTML = "";
Â  Â  let total = 0, index = 1;

Â  if (expenseSnap.exists()) {
Â  expenseSnap.forEach(child => {
Â  Â  // ğŸŒŸ UPDATED: Destructuring 'details' field
Â  Â  const { name, amount, type, details, date } = child.val(); 
Â  Â  const id = child.key;
Â  Â  total += amount;

Â  Â  table.innerHTML += `
Â  Â  Â  <tr class="border-b">
Â  Â  Â  Â  <td class="p-2">${index++}</td>
Â  Â  Â  Â  <td class="p-2">${name}</td>
Â  Â  Â  Â  <td class="p-2">â‚¹${amount}</td>
Â  Â  Â  Â  <td class="p-2">${type || ""}</td> 
Â  Â  Â  Â  <td class="p-2">${details || "N/A"}</td> Â  Â  Â  Â  <td class="p-2">${date}</td>
Â  Â  Â  Â  <td class="p-2">
Â  Â  Â  Â  Â  <button onclick="editExpense('${month}', '${id}', '${name}', ${amount}, '${type}', '${details}')" class="bg-yellow-400 px-2 py-1 rounded">Edit</button>
Â  Â  Â  Â  Â  <button onclick="deleteExpense('${month}', '${id}')" class="bg-red-500 text-white px-2 py-1 rounded ml-2">Delete</button>
Â  Â  Â  Â  </td>
Â  Â  Â  </tr>`;
Â  });
}

Â  Â  document.getElementById("monthExpense").textContent = `â‚¹${total}`;
Â  Â  document.getElementById("monthSaving").textContent = `â‚¹${income - total}`;

Â  Â  const incomeYearSnap = await db.ref(`users/${currentUID}/income`).get();
Â  Â  const expenseYearSnap = await db.ref(`users/${currentUID}/expenses`).get();

Â  Â  let totalSaving = 0;
Â  Â  const allMonths = new Set([
Â  Â  Â  ...Object.keys(incomeYearSnap.val() || {}),
Â  Â  Â  ...Object.keys(expenseYearSnap.val() || {})
Â  Â  ]);

Â  Â  allMonths.forEach(month => {
Â  Â  Â  const monthIncome = incomeYearSnap.child(month).val() || 0;
Â  Â  Â  let monthExpense = 0;
Â  Â  Â  const exp = expenseYearSnap.child(month);
Â  Â  Â  if (exp.exists()) {
Â  Â  Â  Â  exp.forEach(c => {
Â  Â  Â  Â  Â  monthExpense += c.val().amount || 0;
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  totalSaving += monthIncome - monthExpense;
Â  Â  });

Â  Â  document.getElementById("overallSaving").textContent = `â‚¹${totalSaving}`;
Â  }

Â  // ğŸ›‘ Removed old editExpense function here

Â  function deleteExpense(month, id) {
Â  Â  if (confirm("Are you sure you want to delete this expense?")) {
Â  Â  Â  db.ref(`users/${currentUID}/expenses/${month}/${id}`).remove().then(loadData);
Â  Â  }
Â  }

Â  function filterTable() {
Â  Â  const input = document.getElementById("searchInput").value.toLowerCase();
Â  Â  const rows = document.getElementById("expenseTable").getElementsByTagName("tr");
Â  Â  for (let row of rows) {
Â  Â  Â  const text = row.innerText.toLowerCase();
Â  Â  Â  row.style.display = text.includes(input) ? "" : "none";
Â  Â  }
Â  }

window.addEventListener("load", () => {
Â  const now = new Date();
Â  document.getElementById("monthSelector").value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, "0")}`;

Â  const printBtn = document.getElementById("printExpensesBtn");
Â  if (printBtn) {
Â  Â  printBtn.addEventListener("click", printAllExpenses);
Â  }

Â  const logoutBtn = document.getElementById("logoutBtn");
Â  if (logoutBtn) {
Â  Â  logoutBtn.addEventListener("click", () => {
Â  Â  Â  auth.signOut().then(() => location.href = "index.html").catch(console.error);
Â  Â  });
Â  }

Â  // âœ… ADD THIS LINE TO LISTEN FOR MONTH CHANGE
Â  document.getElementById("monthSelector").addEventListener("change", loadData);
Â  // ğŸŒŸ ADD LISTENER FOR DYNAMIC INPUT ğŸŒŸ
Â  document.getElementById("expenseType").addEventListener("change", updateDynamicInput);
Â  updateDynamicInput(); // Initialize the dynamic input field on load
});




</script>
<script>
Â  window.addEventListener("DOMContentLoaded", () => {
Â  // Wait for Firebase auth state and DOM to be ready
Â  firebase.auth().onAuthStateChanged(function(user) {
Â  Â  if (user) {
Â  Â  Â  const currentUID = user.uid;
Â  Â  Â  const db = firebase.database();

Â  Â  Â  const monthSelector = document.getElementById("monthSelector");

Â  Â  Â  // Create button
Â  Â  Â  const printBtn = document.createElement("button");
Â  Â  Â  printBtn.id = "printMonthBtn";
Â  Â  Â  printBtn.innerText = "ğŸ–¨ï¸ Print This Month";
Â  Â  Â  printBtn.style.backgroundColor = "#4CAF50";
Â  Â  Â  printBtn.style.color = "white";
Â  Â  Â  printBtn.style.padding = "10px 16px";
Â  Â  Â  printBtn.style.border = "none";
Â  Â  Â  printBtn.style.borderRadius = "6px";
Â  Â  Â  printBtn.style.fontSize = "16px";
Â  Â  Â  printBtn.style.cursor = "pointer";
Â  Â  Â  printBtn.style.marginLeft = "10px";

Â  Â  Â  if (monthSelector && monthSelector.parentNode) {
Â  Â  Â  Â  monthSelector.parentNode.insertBefore(printBtn, monthSelector.nextSibling);
Â  Â  Â  }

Â  Â  Â  // Button click logic
Â  Â  Â  printBtn.addEventListener("click", async () => {
Â  Â  Â  Â  const month = monthSelector.value;
Â  Â  Â  Â  if (!month) {
Â  Â  Â  Â  Â  alert("Please select a month.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const incomeSnap = await db.ref(`users/${currentUID}/income/${month}`).once('value');
Â  Â  Â  Â  const expenseSnap = await db.ref(`users/${currentUID}/expenses/${month}`).once('value');

Â  Â  Â  Â  const income = incomeSnap.exists() ? incomeSnap.val() : 0; // Assuming income is stored directly as a number
Â  Â  Â  Â  const expenses = expenseSnap.exists() ? expenseSnap.val() : {};

Â  Â  Â  Â  let content = `<h2>Finance Report for ${month}</h2>`;
Â  Â  Â  Â  content += `<p><strong>Income:</strong> â‚¹${income}</p>`;
Â  Â  Â  Â  content += `<h3>Expenses:</h3>`;

Â  Â  Â  Â  if (Object.keys(expenses).length === 0) {
Â  Â  Â  Â  Â  content += `<p>No expenses found.</p>`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  content += `<ul>`;
Â  Â  Â  Â  Â  for (const key in expenses) {
Â  Â  Â  Â  Â  Â  const { name, amount, details } = expenses[key];
Â  Â  Â  Â  Â  Â  content += `<li>${name} (${details || 'N/A'}): â‚¹${amount}</li>`;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  content += `</ul>`;
Â  Â  Â  Â  }

Â  Â  Â  Â  const printWindow = window.open("", "_blank");
Â  Â  Â  Â  printWindow.document.write(`
Â  Â  Â  Â  Â  <html>
Â  Â  Â  Â  Â  Â  <head><title>Print Report</title></head>
Â  Â  Â  Â  Â  Â  <body style="font-family: Arial, sans-serif; padding: 20px;">
Â  Â  Â  Â  Â  Â  Â  ${content}
Â  Â  Â  Â  Â  Â  </body>
Â  Â  Â  Â  Â  </html>
Â  Â  Â  Â  `);
Â  Â  Â  Â  printWindow.document.close();
Â  Â  Â  Â  printWindow.print();
Â  Â  Â  });
Â  Â  }
Â  });
});

</script>
<script>
// ğŸŒŸ UPDATED: The addExpense function now captures the 'details' field
async function addExpense() {
Â  const name = document.getElementById("expenseName").value.trim();
Â  const amount = parseFloat(document.getElementById("expenseAmount").value);
Â  const type = document.getElementById("expenseType").value || "";
Â  const details = document.getElementById("detailsInput").value.trim(); // Capture the dynamic input
Â  const month = getSelectedMonth();

Â  if (!month || !name || isNaN(amount)) {
Â  Â  return alert("Please fill all required fields (name and amount)");
Â  }

Â  try {
Â  Â  const newRef = db.ref(`users/${currentUID}/expenses/${month}`).push();
Â  Â  await newRef.set({
Â  Â  Â  name,
Â  Â  Â  amount,
Â  Â  Â  type, 
Â  Â  Â  details, // Save the dynamic details
Â  Â  Â  date: new Date().toLocaleDateString()
Â  Â  });

Â  Â  // Clear input fields and reset dynamic placeholder
Â  Â  document.getElementById("expenseName").value = "";
Â  Â  document.getElementById("expenseAmount").value = "";
Â  Â  document.getElementById("expenseType").value = ""; 
Â  Â  document.getElementById("detailsInput").value = "";
Â  Â  updateDynamicInput(); // Reset placeholder/type

Â  Â  loadData(); 
Â  } catch (error) {
Â  Â  console.error("Error adding expense:", error);
Â  Â  alert("Failed to add expense. Check console for details.");
Â  }
}

// Function to get selected month
function getSelectedMonth() {
Â  return document.getElementById("monthSelector").value || null;
}

// ğŸŒŸ NEW: Dynamic Input Control Function
function updateDynamicInput() {
Â  const type = document.getElementById("expenseType").value;
Â  const detailsInput = document.getElementById("detailsInput");

Â  detailsInput.value = ""; // Clear value on type change
Â  detailsInput.classList.remove("hidden"); // Ensure it's visible by default
Â  detailsInput.type = "text"; // Default to text

Â  let placeholder = "Specific Details (Optional)";

Â  switch (type) {
Â  Â  case "Mobile Recharge":
Â  Â  Â  placeholder = "Enter User Name (for Mob No. lookup)";
Â  Â  Â  // In a real app, this would be a <select> populated from Firebase contacts
Â  Â  Â  break;
Â  Â  case "Home Maintenance":
Â  Â  Â  placeholder = "Home Owner Name (for Rent)";
Â  Â  Â  break;
Â  Â  case "Entertainment":
Â  Â  Â  placeholder = "Movie Hall/Stadium & Event Name";
Â  Â  Â  break;
Â  Â  case "Medicine":
Â  Â  Â  placeholder = "Chemist/Shop Name";
Â  Â  Â  break;
Â  Â  case "School/College Fee":
Â  Â  Â  placeholder = "School/College Name";
Â  Â  Â  break;
Â  Â  default:
Â  Â  Â  placeholder = "Specific Details (N/A for this type)";
Â  Â  Â  detailsInput.classList.add("hidden");
Â  Â  Â  break;
Â  }

Â  detailsInput.placeholder = placeholder;
}

// ğŸŒŸ UPDATED: The editExpense function now prompts for 'details'
function editExpense(month, id, currentName, currentAmount, currentType, currentDetails) {
Â  Â  if (!currentUID) return alert("User not logged in");

Â  Â  const newName = prompt("Edit name:", currentName);
Â  Â  if (newName === null || newName.trim() === "") return;

Â  Â  const newAmountStr = prompt("Edit amount:", currentAmount);
Â  Â  if (newAmountStr === null) return;
Â  Â  const newAmount = parseFloat(newAmountStr.trim());
Â  Â  if (isNaN(newAmount)) return alert("Invalid amount");

Â  Â  // Prompt for new details if the old one exists
Â  Â  const newDetails = prompt(`Edit details for ${currentType}:`, currentDetails || "");

Â  Â  db.ref(`users/${currentUID}/expenses/${month}/${id}`).update({
Â  Â  Â  name: newName.trim(),
Â  Â  Â  amount: newAmount,
Â  Â  Â  details: newDetails.trim() || null // Save the new details
Â  Â  }).then(loadData).catch(err => {
Â  Â  Â  console.error("Update failed:", err);
Â  Â  Â  alert("Failed to update expense");
Â  Â  });
Â  }
</script>
<script>
let expenseChart = null; // global chart variable

// ğŸŒŸ UPDATED: The loadData function is repeated here, ensure you use the version that handles 'details'
async function loadData() {
Â  const month = getSelectedMonth();
Â  if (!month || !currentUID) return;

Â  const incomeSnap = await db.ref(`users/${currentUID}/income/${month}`).get();
Â  const income = incomeSnap.exists() ? incomeSnap.val() : 0;
Â  document.getElementById("incomeDisplay").textContent = `â‚¹${income}`;

Â  const expenseSnap = await db.ref(`users/${currentUID}/expenses/${month}`).get();
Â  const table = document.getElementById("expenseTable");
Â  table.innerHTML = "";
Â  let total = 0, index = 1;

Â  const typeTotals = {}; // for pie chart

Â  if (expenseSnap.exists()) {
Â  Â  expenseSnap.forEach(child => {
Â  Â  Â  // ğŸŒŸ UPDATED: Added 'details' here
Â  Â  Â  const { name, amount, type = "Miscellaneous", details = "N/A", date } = child.val();Â 
Â  Â  Â  const id = child.key;
Â  Â  Â  total += amount;

Â  Â  Â  if (!typeTotals[type]) typeTotals[type] = 0;
Â  Â  Â  typeTotals[type] += amount;

Â  Â  Â  table.innerHTML += `
Â  Â  Â  Â  <tr class="border-b">
Â  Â  Â  Â  Â  <td class="p-2">${index++}</td>
Â  Â  Â  Â  Â  <td class="p-2">${name}</td>
Â  Â  Â  Â  Â  <td class="p-2">â‚¹${amount}</td>
Â  Â  Â  Â  Â  <td class="p-2">${type}</td>
Â  Â  Â  Â  Â  <td class="p-2">${details}</td> Â  Â  Â  Â  Â  <td class="p-2">${date}</td>
Â  Â  Â  Â  Â  <td class="p-2">
Â  Â  Â  Â  Â  Â  <button onclick="editExpense('${month}', '${id}', '${name}', ${amount}, '${type}', '${details}')" class="bg-yellow-400 px-2 py-1 rounded">Edit</button>
Â  Â  Â  Â  Â  Â  <button onclick="deleteExpense('${month}', '${id}')" class="bg-red-500 text-white px-2 py-1 rounded ml-2">Delete</button>
Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  </tr>`;
Â  Â  });
Â  }

Â  document.getElementById("monthExpense").textContent = `â‚¹${total}`;
Â  document.getElementById("monthSaving").textContent = `â‚¹${income - total}`;

Â  // Logic for Overall Saving (kept for completeness)

Â  Â  const incomeYearSnap = await db.ref(`users/${currentUID}/income`).get();
Â  Â  const expenseYearSnap = await db.ref(`users/${currentUID}/expenses`).get();

Â  Â  let totalSaving = 0;
Â  Â  const allMonths = new Set([
Â  Â  Â  ...Object.keys(incomeYearSnap.val() || {}),
Â  Â  Â  ...Object.keys(expenseYearSnap.val() || {})
Â  Â  ]);

Â  Â  allMonths.forEach(month => {
Â  Â  Â  const monthIncome = incomeYearSnap.child(month).val() || 0;
Â  Â  Â  let monthExpense = 0;
Â  Â  Â  const exp = expenseYearSnap.child(month);
Â  Â  Â  if (exp.exists()) {
Â  Â  Â  Â  exp.forEach(c => {
Â  Â  Â  Â  Â  monthExpense += c.val().amount || 0;
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  totalSaving += monthIncome - monthExpense;
Â  Â  });

Â  Â  document.getElementById("overallSaving").textContent = `â‚¹${totalSaving}`;


Â  // Pie chart data
Â  const labels = Object.keys(typeTotals);
Â  const data = Object.values(typeTotals);
Â  const ctx = document.getElementById('expenseTypeChart').getContext('2d');

Â  if (expenseChart) expenseChart.destroy();

Â  expenseChart = new Chart(ctx, {
Â  Â  type: 'pie',
Â  Â  data: {
Â  Â  Â  labels,
Â  Â  Â  datasets: [{
Â  Â  Â  Â  data,
Â  Â  Â  Â  backgroundColor: [
Â  Â  Â  Â  Â  '#FF6384','#36A2EB','#FFCE56','#8BC34A','#FF9800',
Â  Â  Â  Â  Â  '#9C27B0','#00BCD4','#E91E63','#3F51B5','#CDDC39'
Â  Â  Â  Â  ],
Â  Â  Â  Â  borderWidth: 2,
Â  Â  Â  Â  borderColor: '#fff',
Â  Â  Â  Â  hoverOffset: 12
Â  Â  Â  }]
Â  Â  },
Â  Â  options: {
Â  Â  Â  responsive: false, // fixed size
Â  Â  Â  plugins: {
Â  Â  Â  Â  legend: { position: 'right', labels: { boxWidth: 12, padding: 10, font: { size: 10 } } },
Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  label: context => `${context.label}: â‚¹${context.raw}`
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  });
}
</script>





</body>
</html>