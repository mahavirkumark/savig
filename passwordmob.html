<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Savig</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* Animations */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInUp 0.8s forwards; }
        .slide-left { opacity: 0; transform: translateX(-20px); animation: slideLeft 0.8s forwards; }
        .slide-right { opacity: 0; transform: translateX(20px); animation: slideRight 0.8s forwards; }

        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes slideLeft { to { opacity: 1; transform: translateX(0); } }
        @keyframes slideRight { to { opacity: 1; transform: translateX(0); } }

        

        /* Ensure scrollable area looks clean */
        #cred-list::-webkit-scrollbar { width: 8px; }
        #cred-list::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }

        /* Custom style for the full-screen search overlay */
        .full-search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white; 
            z-index: 50; 
            overflow-y: auto;
            display: none; 
        }
        
        /* Custom Logout Button Size */
        .logout-btn-circle {
            width: 80px; 
            height: 44px; 
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50px; 
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
        }

        /* Styles for custom field swap */
        .select-group {
            position: relative;
            flex-basis: 40%;
            min-width: 100px;
        }
        .input-group {
            flex-basis: 60%;
            display: flex;
            align-items: center;
        }
        /* FIX: Ensure the input covers the select when swapped, height: 100% is crucial for alignment */
        .select-group > input.swapped-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-700 font-sans">
<div class="mb-6 border-b pb-4">
    <h2 class="text-lg font-extrabold text-gray-900 flex items-center gap-1 mt-1 ml-2">
        <i class="fas fa-map-location-dot text-blue-600"></i>
        Address Directory
    </h2>
    <h2 class="text-xm text-gray-900 mt-1 ml-5">Manage and access your saved locations instantly.</h2>
</div>
 <body class="bg-gray-100 text-gray-700 font-sans">

    <div id="mobile-search-overlay" class="full-search-overlay">
        <header class="bg-white shadow-md p-2 flex items-center ">
            <button id="close-search-btn" class="text-gray-700 hover:text-red-500 text-xl p-2 rounded-lg focus:outline-none">
                <i class="fas fa-arrow-left"></i>
            </button>
            <input type="text" id="searchInputMobileOverlay" placeholder="ðŸ” Search your passwords..." class="w-full px-3 py-2 border border-gray-900 rounded-full shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium transition" />
        </header>
        <div id="cred-list-mobile-overlay" class="p-4 space-y-4 grid sm:grid-cols-1 gap-1"></div>
    </div>

    <div class="hidden md:block fade-in">
        <header class="bg-white shadow-md p-2 flex justify-between items-center">
            <div class="flex items-center gap-1 slide-left">
                <div class="relative flex items-center justify-center">
                    <i class="fas fa-shield text-blue-600" style="font-size:32px;"></i>
                    <i class="fas fa-database text-white absolute" style="font-size: 16px; top: 50%; left: 50%;  ; transform: translate(-50%, -50%);"></i>
                </div>
                <span class="font-black text-gray-900 tracking-tighter" style="font-size: 24px;margin-right:200px">Savig</span>
            </div>

   
            <div class="flex items-center gap-4 slide-right">
                <div class="text-right">
                    <p id="user-name" class="font-medium text-black text-base">User Name</p>
                    <p id="user-email" class="text-sm text-gray-500">user@example.com</p>
                </div>
                <img id="user-pic" src="https://via.placeholder.com/100" alt="User Photo" class="w-12 h-12 rounded-full border" />
                <button id="logout-btn" class="bg-red-500 text-white hover:bg-red-600 logout-btn-circle">Logout</button>
            </div>
        </header>

        <div class="w-full px-6 mx-auto  grid grid-cols-1 md:grid-cols-3 gap-1 max-w-screen-2xl mt-[-35]">
            <div class="bg-white rounded-xl shadow-xl p-2 flex flex-col space-y-2 md:col-span-1 fade-in transition duration-300 hover:shadow-2xl">
                <h2 id="form-title" class="text-lg font-semibold mb-1 text-center text-gray-800">Add New Credential</h2>
                <div id="custom-fields-container"></div>
                <button id="add-custom-field-btn" type="button" class="text-sm py-2 rounded border border-blue-900 text-blue-900 hover:bg-blue-100 transition">
                    <i class="fas fa-plus mr-2"></i> Add Custom Field 
                </button>
                <button id="save-btn" class="bg-blue-900 text-white text-sm py-2 rounded hover:bg-blue-800 mt-1 transition duration-150">
                    <i class="fas fa-save mr-2"></i> Save Credential
                </button>
                <button id="cancel-edit-btn" class="bg-gray-500 text-white text-sm py-2 rounded hover:bg-gray-600 mt-1 hidden transition duration-150">
                    <i class="fas fa-times mr-2"></i> Cancel Edit
                </button>
                <p id="save-message" class="text-center text-sm text-green-600 font-medium hidden">Credential saved!</p>
            </div>

            <div class="bg-white rounded-xl shadow-xl p-6 flex flex-col space-y-4 md:col-span-2 fade-in transition duration-300 hover:shadow-2x">
                <h2 class="text-lg font-semibold text-center text-gray-800">Saved Credentials</h2>
                <div class="flex justify-center">
                    <input type="text" id="searchInput" placeholder="ðŸ” Search your passwords..." class="w-full max-w-2xl px-5 py-4 border border-gray-300 rounded-full shadow-inner focus:outline-none focus:ring-2 focus:ring-blue-500 text-[18px] font-bold transition" />
                </div>
                <div id="cred-list" class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 max-h-[65vh] overflow-y-auto"></div>
            </div>
        </div>
    </div>



  



        <div class="bg-white rounded-xl shadow-xl p-4 mx-2 my-2 flex flex-col space-y-6 fade-in transition duration-300 hover:shadow-2xl">
            <div class="bg-white rounded-lg shadow-inner p-4 space-y-3 w-full">
                <h3 id="form-title-m" class="text-lg font-semibold mb-2 text-center text-gray-700">Add New Credential</h3>
                
                <div id="custom-fields-container-m">
                    </div>

                <button id="add-custom-field-btn-m" type="button" class="text-sm py-2 rounded border border-blue-700 text-blue-700 hover:bg-blue-100 mt-1 w-full flex justify-center items-center font-medium transition">
                    <i class="fas fa-plus mr-2"></i> Add Custom Field 
                </button>

                <button id="save-btn-m" class="bg-blue-700 text-white text-sm py-2 rounded hover:bg-blue-600 mt-2 w-full flex justify-center items-center font-medium transition">
                    <i class="fas fa-save mr-2"></i> Save Credential
                </button>
                <button id="cancel-edit-btn-m" class="bg-gray-500 text-white text-sm py-2 rounded hover:bg-gray-600 mt-1 w-full flex justify-center items-center font-medium transition hidden">
                    <i class="fas fa-times mr-2"></i> Cancel Edit
                </button>
                <p id="save-message-m" class="text-center text-sm text-green-600 font-medium hidden">Credential saved!</p>
            </div>
      <input type="text" id="searchInputMobile" placeholder="ðŸ” Search your passwords..." class="w-full px-3 py-2 border border-gray-400 rounded-full shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium transition" readonly />
            <h2 class="text-lg font-semibold text-center">Saved Credentials</h2>
            <div id="cred-list-mobile" class="grid sm:grid-cols-1 gap-4">
                </div>
        </div>
    </div>

   


</body>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">





<div class="nav-spacer" style="height: 75px; width: 100%;"></div>
    <script>
        // NOTE: Replace these with your actual Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB78RTVCg0cmSPp7A1RJyyAgBuCeolO0cc", // Placeholder
            authDomain: "sk12-58e9e.firebaseapp.com", // Placeholder
            databaseURL: "https://sk12-58e9e-default-rtdb.firebaseio.com", // Placeholder
            projectId: "sk12-58e9e",
            storageBucket: "sk12-58e9e.appspot.com",
            messagingSenderId: "470207874652",
            appId: "1:470207874652:web:67ba1cf3629b7e5b144899"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        let currentUser = null;

        // --- Custom Fields Configuration (Updated List - Alphabetized) ---
        const CUSTOM_FIELD_OPTIONS = [
            "Aadhaar No", 
            "Account Name", 
            "Account No", 
            "Address", 
            "Amount", 
            "Apartment Security Code", 
            "API Key", 
            "API Token", 
            "ATM PIN", 
            "Bank Account No", 
            "Bank Routing Number", 
            "Billing Address", 
            "Building Name", 
            "Broadband Acc No", 
            "Client ID", 
            "Client Secret", 
            "Cloud API Key", 
            "Consumer No", 
            "Container ID", 
            "Credit Card CVV", 
            "Credit Card No", 
            "Customer No", 
            "Customer Support PIN", 
            "Database Schema", 
            "Date of Birth", 
            "Debit Card No", 
            "Demant Account No", 
            "Device Serial No", 
            "Digital Certificate", 
            "Digital Wallet Address", 
            "Domain Name", 
            "Driver's License No", 
            "DTH Customer ID", 
            "Electricity Bill Acc No", 
            "Employee ID", 
            "Encryption Key", 
            "Expiry Date", 
            "FTP Host", 
            "Gas Connection ID", 
            "Gold Weight/Details", 
            "Hardware Serial", 
            "Health ID", 
            "House/Flat Number", 
            "IBAN", 
            "IFSC Code", 
            "Insurance Policy No", 
            "Investment Account No", 
            "IP Address", 
            "Issue Date", 
            "Landline Number", 
            "Lease/Rental Agreement ID", 
            "Library Card No", 
            "License Key", 
            "Loan Account No", 
            "Locker Combination", 
            "Loyalty Card No", 
            "Membership No", 
            "Mobile No", 
            "Network Name", 
            "Notes", 
            "Order Number", 
            "Ornament Details", 
            "PAN No", 
            "Passport No", 
            "Phone Number (Secondary)", 
            "PIN", 
            "P.O. Box", 
            "Port Number", 
            "Post Office Account No", 
            "Primary Phone", 
            "Project Code", 
            "Property Tax ID", 
            "Recovery Code", 
            "Recovery Email", 
            "Reference ID", 
            "Reg No", 
            "Router Password", 
            "Security Q&A", 
            "Security Token", 
            "Secret Key", 
            "Server Key", 
            "Shipping Tracking No", 
            "Silver Weight/Details", 
            "Software License", 
            "Software Version", 
            "Sponsor Code", 
            "SSH Key", 
            "Subscription ID", 
            "Swift Code", 
            "Tax Filing PIN", 
            "Tax ID", 
            "Trading PIN", 
            "Two-Factor Code", 
            "UPI ID", 
            "User ID", 
            "VC No", 
            "Virtual Machine Name", 
            "Voter ID No", 
            "VPN Credentials", 
            "Water Bill Acc No", 
            "Website URL", 
            "WiFi Password"
        ];
        // Removed MAX_CUSTOM_FIELDS to allow "infinite"
        // const MAX_CUSTOM_FIELDS = 5;

        // --- Utility Functions ---

        /**
         * Generates an AES-GCM encryption key from a user ID and a secret seed.
         */
        async function getKey(uid) {
            const enc = new TextEncoder();
            const base = await crypto.subtle.digest("SHA-256", enc.encode(uid + "_secret_key"));
            return crypto.subtle.importKey("raw", base, { name: "AES-GCM" }, false, ["encrypt","decrypt"]);
        }

        /**
         * Encrypts a string using AES-GCM and returns a base64 string with IV prepended.
         */
        async function encryptString(text, uid) {
            const key = await getKey(uid);
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const enc = new TextEncoder().encode(text);
            const buf = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, key, enc);
            // Prepend IV to the encrypted data and encode to base64
            return btoa(String.fromCharCode(...iv) + String.fromCharCode(...new Uint8Array(buf)));
        }

        /**
         * Decrypts a base64 string (with prepended IV) using AES-GCM.
         */
        async function decryptString(base64, uid) {
            try {
                const raw = atob(base64);
                // Extract IV (first 12 bytes)
                const iv = Uint8Array.from(raw.slice(0,12), c=>c.charCodeAt(0));
                // Extract encrypted data (rest of the string)
                const data = Uint8Array.from(raw.slice(12), c=>c.charCodeAt(0));
                const key = await getKey(uid);
                const dec = await crypto.subtle.decrypt({ name:"AES-GCM", iv }, key, data);
                return new TextDecoder().decode(dec);
            } catch {
                return ""; // fallback if corrupted/plaintext
            }
        }

        /**
         * Copies text to the clipboard and provides visual feedback on the button.
         */
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = "Copy";
                const newText = "Copied!";
                button.innerText = newText;
                button.disabled = true;
                button.classList.remove("bg-blue-600");
                button.classList.add("bg-green-600");
                button.style.transform = "scale(1.1)";
                button.style.transition = "all 0.2s ease-in-out";
                setTimeout(() => {
                    button.innerText = originalText;
                    button.disabled = false;
                    button.classList.remove("bg-green-600");
                    button.classList.add("bg-blue-600");
                    button.style.transform = "scale(1)";
                }, 1500);
            });
        }

        /**
         * Toggles the visibility of a credential value (from 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' to actual value).
         */
        function toggleVisibility(button) {
            const parent = button.closest("p");
            if (!parent) return;
            const valueSpan = parent.querySelector(".cred-value");
            const isHidden = valueSpan.textContent === "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢";
            if (isHidden) {
                valueSpan.textContent = valueSpan.getAttribute("data-original");
                button.innerHTML = `<i class="fas fa-eye"></i>`;
                button.classList.remove("text-gray-500");
                button.classList.add("text-blue-600");
            } else {
                valueSpan.textContent = "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢";
                button.innerHTML = `<i class="fas fa-eye-slash"></i>`;
                button.classList.remove("text-blue-600");
                button.classList.add("text-gray-500");
            }
        }
        
        /**
         * Custom function to open a URL in a new tab/window.
         */
        function openLinkInNewTab(url) {
            if (url) {
                // Ensure the URL has a protocol for proper opening
                const fullUrl = url.startsWith('http') ? url : `https://${url}`;
                window.open(fullUrl, '_blank');
            }
        }

        // --- Custom Field Logic ---

        /**
         * Updates the text and state of the 'Add Custom Field' button.
         * MODIFIED: Removed MAX_CUSTOM_FIELDS check.
         */
        function updateAddButtonState(isMobile) {
            const container = document.getElementById(isMobile ? "custom-fields-container-m" : "custom-fields-container");
            const button = document.getElementById(isMobile ? "add-custom-field-btn-m" : "add-custom-field-btn");

            if (!container || !button) return;

            const currentFields = container.querySelectorAll(".custom-field-row").length;
            const primaryColor = isMobile ? "blue-700" : "blue-900";
            
            button.disabled = false;
            button.innerHTML = `<i class="fas fa-plus mr-2"></i> Add Custom Field (No Limit)`;
            button.classList.remove("border-gray-400", "text-gray-400");
            button.classList.add(`border-${primaryColor}`, `text-${primaryColor}`, "hover:bg-blue-100");
        }

        /**
         * Removes a custom field row and updates the button state.
         */
        function removeCustomField(button, isMobile) {
            const row = button.closest(".custom-field-row");
            if (row) {
                row.remove();
                updateAddButtonState(isMobile);
            }
        }
        
        /**
         * Adds a custom field row to the container form.
         */
        function addCustomField(isMobile=false, label = "", value = "") {
            const container = document.getElementById(isMobile ? "custom-fields-container-m" : "custom-fields-container");
            if (!container) return;

            // Removed MAX_CUSTOM_FIELDS check
            // const currentFields = container.querySelectorAll(".custom-field-row").length;
            // if (currentFields >= MAX_CUSTOM_FIELDS) {
            //     updateAddButtonState(isMobile);
            //     return;
            // }
            
            const id = Date.now() + Math.random().toString(36).substring(7);
            // Check if the loaded label is in the standard options
            const isCustomLabel = label && !CUSTOM_FIELD_OPTIONS.includes(label);
            const selectedLabel = isCustomLabel ? 'Custom Label' : label;
            const customLabelValue = isCustomLabel ? label : '';
            
            // Determine the value placeholder text
            let valuePlaceholder = "Value (Optional)";
            if (label) {
                valuePlaceholder = `Value (Label: ${label})`; 
            }
            
            // CSS classes
            const selectClasses = "border px-3 py-2 rounded text-sm w-full focus:ring-2 focus:ring-blue-500";
            const inputClasses = "border px-3 py-2 rounded text-sm w-full focus:ring-2 focus:ring-blue-500";
            const removeBtnClasses = "text-red-500 hover:text-red-700 text-lg ml-2";

            const fieldRow = document.createElement('div');
            fieldRow.className = "custom-field-row flex items-center gap-1 mb-[2px]"; 
            fieldRow.innerHTML = `
                <div class="select-group">
                    <select id="custom-label-select-${id}" class="${selectClasses} ${isCustomLabel ? 'hidden' : ''}">
                        <option value="">-- Select Label --</option>
                        ${CUSTOM_FIELD_OPTIONS.map(opt => `<option value="${opt}" ${opt === selectedLabel ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    <input id="custom-label-text-input-${id}" 
                                class="${inputClasses} swapped-input ${isCustomLabel ? '' : 'hidden'}" 
                                placeholder="Enter Custom Label Name" 
                                value="${customLabelValue.replace(/"/g, '&quot;')}"
                    />
                </div>
                
                <div class="input-group">
                    <input id="custom-value-input-${id}" 
                                class="${inputClasses} w-full" 
                                placeholder="${valuePlaceholder}" 
                                value="${value.replace(/"/g, '&quot;')}"
                    />
                    <button type="button" onclick="removeCustomField(this, ${isMobile})" class="${removeBtnClasses}"><i class="fas fa-times"></i></button>
                </div>
            `;
            
            const selectElement = fieldRow.querySelector(`#custom-label-select-${id}`);
            // Simplified logic: Since 'Other' is removed, the select change listener is not complex
            if (selectElement) {
                selectElement.addEventListener('change', (e) => {
                    // No swap logic needed as 'Custom Label' is now a load state, not an option.
                });
            }

            container.appendChild(fieldRow);
            updateAddButtonState(isMobile);
        }
        
        // --- Clear Form Function (Resetting placeholders) ---
        function clearForm(isMobile) {
            const suffix = isMobile ? "-m" : "";
            
            // Reset inputs and ID
            document.getElementById(`title${suffix}`).value = "";
            document.getElementById(`link${suffix}`).value = ""; 
            document.getElementById(`email${suffix}`).value = "";
            document.getElementById(`username${suffix}`).value = "";
            document.getElementById(`password${suffix}`).value = "";
            document.getElementById(`credential-id${isMobile ? '-mobile' : '-desktop'}`).value = "";
            document.getElementById(isMobile ? "custom-fields-container-m" : "custom-fields-container").innerHTML = "";

            // Reset placeholders to original text
            document.getElementById(`title${suffix}`).placeholder = "App / Web / Service / Product Name (Optional)";
            document.getElementById(`link${suffix}`).placeholder = "Website Link (Optional)"; 
            document.getElementById(`email${suffix}`).placeholder = "Email (Optional)";
            document.getElementById(`username${suffix}`).placeholder = "Username (Optional)";
            document.getElementById(`password${suffix}`).placeholder = "Password (Optional)";
            
            // Reset UI for 'Add New'
            document.getElementById(`form-title${suffix}`).innerText = "Add New Credential";
            document.getElementById(`save-btn${suffix}`).innerText = "Save Credential";
            document.getElementById(`cancel-edit-btn${suffix}`).classList.add("hidden");
            updateAddButtonState(isMobile);
        }

        // --- Save/Update Function ---
        async function saveOrUpdateCredential(isMobile=false) {
            if (!currentUser) return;

            const suffix = isMobile ? "-m" : "";
            const credentialIdEl = document.getElementById(`credential-id${isMobile ? '-mobile' : '-desktop'}`);
            const existingId = credentialIdEl.value;

            const title = document.getElementById(`title${suffix}`)?.value.trim();
            const link = document.getElementById(`link${suffix}`)?.value.trim(); 
            const email = document.getElementById(`email${suffix}`)?.value.trim();
            const username = document.getElementById(`username${suffix}`)?.value.trim();
            const password = document.getElementById(`password${suffix}`)?.value.trim();

            const payload = {
                // Use a default title if none is provided, or store the empty string
                title: title || "Untitled Credential",
                // Encrypting core fields if they exist
                link: link ? await encryptString(link, currentUser.uid) : "", 
                email: email ? await encryptString(email, currentUser.uid) : "",
                username: username ? await encryptString(username, currentUser.uid) : "",
                password: password ? await encryptString(password, currentUser.uid) : "", 
                customFields: {}
            };

            // Get Custom Fields
            const containerId = isMobile ? "custom-fields-container-m" : "custom-fields-container";
            const customFieldsContainer = document.getElementById(containerId);
            const fieldRows = customFieldsContainer.querySelectorAll(".custom-field-row");

            for(const row of fieldRows) {
                const valueInput = row.querySelector('input[id^="custom-value-input-"]');
                const labelSelect = row.querySelector('select[id^="custom-label-select-"]');
                const labelTextInput = row.querySelector('input[id^="custom-label-text-input-"]');

                let actualValue = valueInput?.value.trim() || "";
                let label = labelSelect?.value.trim() || "";
                
                // Determine final label
                if (labelSelect && labelSelect.classList.contains('hidden') && labelTextInput) {
                    // Use the custom label text input value if it was visible (i.e., custom label loaded)
                    label = labelTextInput.value.trim() || "";
                } else if (!label) {
                    // If label is empty and select is visible, treat as skipped or invalid.
                    continue; 
                }
                
                // Only save custom fields if both a non-empty label and a non-empty value exist
                if (label && actualValue) {
                    payload.customFields[label] = await encryptString(actualValue, currentUser.uid);
                }
            }

            const id = existingId || Date.now().toString();
            db.ref(`users/${currentUser.uid}/credentials/${id}`).set(payload)
                .then(() => {
                    clearForm(isMobile);
                    
                    const action = existingId ? "Updated" : "Saved";
                    const saveMsg = document.getElementById(isMobile ? "save-message-m" : "save-message");
                    if(saveMsg) {
                        saveMsg.innerText = `Credential ${action}!`;
                        saveMsg.classList.remove("hidden");
                        setTimeout(() => saveMsg.classList.add("hidden"), 3000);
                    }
                    
                    // Re-apply the filter after Firebase reload completes
                    // Note: loadCredentials handles the initial data load/list update via .on("value")
                    filterPasswords(); 
                })
                .catch(error => {
                    alert("Error saving credential: " + error.message);
                });
        }

  
        function editCredential(id, encoded) {
            const data = JSON.parse(decodeURIComponent(encoded));
            const isMobile = window.innerWidth < 768;
            const suffix = isMobile ? "-m" : "";

            clearForm(isMobile); // Clear existing form data first
            
            document.getElementById(`credential-id${isMobile ? '-mobile' : '-desktop'}`).value = id;
            
            // Get Elements
            const titleEl = document.getElementById(`title${suffix}`);
            const linkEl = document.getElementById(`link${suffix}`); 
            const emailEl = document.getElementById(`email${suffix}`);
            const usernameEl = document.getElementById(`username${suffix}`);
            const passwordEl = document.getElementById(`password${suffix}`);

            // Set input values to current data
            titleEl.value = data.title || "";
            linkEl.value = data.link || ""; // Link is decrypted when passed to editCredential
            emailEl.value = data.email || "";
            usernameEl.value = data.username || "";
            passwordEl.value = data.password || ""; // Decrypted value goes into input

            // --- Update placeholders to show the context (Current Value) ---
            const currentTitle = data.title || "(Empty)";
            const currentLink = data.link || "(Empty)"; 
            const currentEmail = data.email || "(Empty)";
            const currentUsername = data.username || "(Empty)";
            
            // For sensitive fields, show a generic indicator
            const currentPasswordDisplay = data.password ? "******" : "(Empty)";
            const currentLinkDisplay = data.link ? currentLink : "(Empty)"; // Link is less sensitive, showing it in placeholder

            // Setting placeholders with the label AND the current value
            const newTitlePlaceholder = `App / Web / Service / Product Name (Current: ${currentTitle})`;
            const newLinkPlaceholder = `Website Link (Current: ${currentLinkDisplay} - Enter new)`; 
            const newEmailPlaceholder = `Email (Current: ${currentEmail})`;
            const newUsernamePlaceholder = `Username (Current: ${currentUsername})`;
            const newPasswordPlaceholder = `Password (Current: ${currentPasswordDisplay} - Enter new)`;
            
            titleEl.placeholder = newTitlePlaceholder;
            linkEl.placeholder = newLinkPlaceholder; 
            emailEl.placeholder = newEmailPlaceholder;
            usernameEl.placeholder = newUsernamePlaceholder;
            passwordEl.placeholder = newPasswordPlaceholder;


            if (data.customFields) {
                Object.entries(data.customFields).forEach(([label, value]) => {
                    // value here is already decrypted
                    addCustomField(isMobile, label, value);
                });
            }

            // Update Form UI
            document.getElementById(`form-title${suffix}`).innerText = `Editing: ${currentTitle}`;
            document.getElementById(`save-btn${suffix}`).innerText = "Update Credential";
            document.getElementById(`cancel-edit-btn${suffix}`).classList.remove("hidden");
            
            // Scroll to form on mobile/desktop
            titleEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        /**
         * Resets the form to 'Add New' state.
         */
        function cancelEdit(isMobile) {
            clearForm(isMobile);
            const saveMsg = document.getElementById(isMobile ? "save-message-m" : "save-message");
            if(saveMsg) saveMsg.innerText = "Credential saved!";
        }

        // --- Load Credentials (Decryption and Display) ---
        async function loadCredentials() {
            if (!currentUser) return;
            
            const desktopList = document.getElementById("cred-list");
            const mobileList = document.getElementById("cred-list-mobile");
            const mobileOverlayList = document.getElementById("cred-list-mobile-overlay"); 
            
            // Clear previous content and show loading message
            const loadingMsg = '<p class="text-gray-500 p-4">Loading...</p>';
            desktopList.innerHTML = loadingMsg;
            mobileList.innerHTML = loadingMsg;
            mobileOverlayList.innerHTML = loadingMsg; 

            // Use .on("value") for real-time updates
            db.ref(`users/${currentUser.uid}/credentials`).on("value", async snapshot=>{
                desktopList.innerHTML="";
                mobileList.innerHTML="";
                mobileOverlayList.innerHTML=""; 

                const rawCredentials = snapshot.val();
                if(!rawCredentials){
                    const msg=`<p class="text-gray-500 p-4">No credentials found.</p>`;
                    desktopList.innerHTML=msg;
                    mobileList.innerHTML=msg;
                    mobileOverlayList.innerHTML=msg;
                    return;
                }
                
                // Process and display each credential
                for(const [id,data] of Object.entries(rawCredentials)){
                    const decLink = data.link ? await decryptString(data.link, currentUser.uid) : ""; // DECRYPT LINK
                    const decEmail = data.email ? await decryptString(data.email, currentUser.uid) : "";
                    const decUsername = data.username ? await decryptString(data.username, currentUser.uid) : "";
                    const decPassword = data.password ? await decryptString(data.password, currentUser.uid) : "";
                    
                    // Compile decrypted data for passing to edit/share functions
                    const decryptedData = {title:data.title, link:decLink, email:decEmail, username:decUsername, password:decPassword, customFields: {}};
                    
                    let customHtml = "";
                    if (data.customFields) {
                        for(const [label, encryptedValue] of Object.entries(data.customFields)) {
                            const decryptedValue = await decryptString(encryptedValue, currentUser.uid);
                            decryptedData.customFields[label] = decryptedValue;
                            if (decryptedValue) {
                                customHtml += `
                                <p class="text-sm text-gray-600 flex items-center justify-between mb-1">
                                    <span>${label}: <span class="cred-value" data-original="${decryptedValue.replace(/"/g, '&quot;')}">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span></span>
                                    <span class="flex items-center gap-1">
                                        <button onclick="toggleVisibility(this)" class="text-gray-500 hover:text-gray-900 text-sm"><i class="fas fa-eye-slash"></i></button>
                                        <button onclick="copyToClipboard('${decryptedValue.replace(/'/g, "\\'")}', this)" class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">Copy</button>
                                    </span>
                                </p>`;
                            }
                        }
                    }

                    // Encode the full decrypted object to safely pass to event handlers (Edit/Share)
                    const safeData = encodeURIComponent(JSON.stringify(decryptedData));

                    const html = `
                    <div class="password-item border p-4 rounded shadow bg-gray-50 flex flex-col" data-id="${id}">
                        <h3 class="website-name font-semibold text-lg text-black mb-2">${data.title || "Untitled Credential"}</h3>
                        
                        ${decLink ? `<p class="text-sm text-gray-600 flex items-center justify-between mb-1">
                            <span>Link: <span class="cred-value" data-original="${decLink.replace(/"/g, '&quot;')}">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span></span>
                            <span class="flex items-center gap-1">
                                <button onclick="toggleVisibility(this)" class="text-gray-500 hover:text-gray-900 text-sm"><i class="fas fa-eye-slash"></i></button>
                                <button onclick="openLinkInNewTab('${decLink.replace(/'/g, "\\'")}')" class="px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700"><i class="fas fa-external-link-alt mr-1"></i>Open</button>
                            </span>
                        </p>` : ""}

                        ${decEmail ? `<p class="text-sm text-gray-600 flex items-center justify-between mb-1">
                            <span>Email: <span class="cred-value" data-original="${decEmail.replace(/"/g, '&quot;')}">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span></span>
                            <span class="flex items-center gap-1">
                                <button onclick="toggleVisibility(this)" class="text-gray-500 hover:text-gray-900 text-sm"><i class="fas fa-eye-slash"></i></button>
                                <button onclick="copyToClipboard('${decEmail.replace(/'/g, "\\'")}', this)" class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">Copy</button>
                            </span>
                        </p>` : ""}
                        ${decUsername ? `<p class="text-sm text-gray-600 flex items-center justify-between mb-1">
                            <span>Username: <span class="cred-value" data-original="${decUsername.replace(/"/g, '&quot;')}">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span></span>
                            <span class="flex items-center gap-1">
                                <button onclick="toggleVisibility(this)" class="text-gray-500 hover:text-gray-900 text-sm"><i class="fas fa-eye-slash"></i></button>
                                <button onclick="copyToClipboard('${decUsername.replace(/'/g, "\\'")}', this)" class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">Copy</button>
                            </span>
                        </p>` : ""}
                        ${decPassword ? `<p class="text-sm text-gray-600 flex items-center justify-between mb-1">
                            <span>Password: <span class="cred-value" data-original="${decPassword.replace(/"/g, '&quot;')}">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span></span>
                            <span class="flex items-center gap-1">
                                <button onclick="toggleVisibility(this)" class="text-gray-500 hover:text-gray-900 text-sm"><i class="fas fa-eye-slash"></i></button>
                                <button onclick="copyToClipboard('${decPassword.replace(/'/g, "\\'")}', this)" class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">Copy</button>
                            </span>
                        </p>` : ""}
                        ${customHtml}
                        <div class="mt-3 flex gap-3 justify-start">
                            <button onclick="editCredential('${id}', '${safeData}')" class="text-blue-600 hover:underline"><i class="fas fa-edit mr-1"></i>Edit</button>
                            <button onclick="deleteCredential('${id}')" class="text-red-600 hover:underline"><i class="fas fa-trash mr-1"></i>Delete</button>
                            <button onclick="shareCredential('${safeData}')" class="text-green-600 hover:underline"><i class="fas fa-share-alt mr-1"></i>Share</button>
                        </div>
                    </div>`;
                    
                    // Append to all relevant lists
                    if(desktopList) desktopList.innerHTML += html;
                    mobileList.innerHTML += html; 
                    mobileOverlayList.innerHTML += html; 
                }
                
                // Ensure filter is run after initial load
                filterPasswords();
            });
        }
        
        // --- Search/Filter Logic ---
        function filterPasswords(){
            // Determine the active search query
            const desktopQuery = document.getElementById("searchInput")?.value.toLowerCase() || "";
            const mobileOverlayQuery = document.getElementById("searchInputMobileOverlay")?.value.toLowerCase() || "";
            
            // Get the query from the active view (Desktop/Mobile Overlay)
            const q = document.getElementById('mobile-search-overlay')?.style.display === 'block' ? mobileOverlayQuery : desktopQuery;
            
            // Get all possible list containers
            const lists = [
                document.getElementById("cred-list"),
                document.getElementById("cred-list-mobile"),
                document.getElementById("cred-list-mobile-overlay")
            ].filter(list => list !== null);

            lists.forEach(list => {
                list.querySelectorAll(`.password-item`).forEach(item => {
                    // Check item's text content (which includes title, email, username, and custom fields)
                    const itemText = item.textContent.toLowerCase();
                    // Show item only if the query is empty OR the item text includes the query
                    item.style.display = itemText.includes(q) ? "flex" : "none";
                });
            });
        }

        // --- Full-Screen Mobile Search Logic ---

        function openMobileSearch() {
            const overlay = document.getElementById('mobile-search-overlay');
            const mainSearchInput = document.getElementById('searchInputMobile');
            const overlaySearchInput = document.getElementById('searchInputMobileOverlay');
            
            overlay.style.display = 'block';
            
            // Sync initial value and focus
            overlaySearchInput.value = mainSearchInput.value;
            overlaySearchInput.focus();
            
            // Re-run filter on the overlay results container
            filterPasswords(); 
        }

        function closeMobileSearch() {
            const overlay = document.getElementById('mobile-search-overlay');
            const mainSearchInput = document.getElementById('searchInputMobile');
            const overlaySearchInput = document.getElementById('searchInputMobileOverlay');
            
            // Sync value back to main search input
            mainSearchInput.value = overlaySearchInput.value;
            
            overlay.style.display = 'none';
        }

        // --- Logout Handler ---
        function handleLogout() {
            auth.signOut().then(() => {
                // Redirection to index.html is handled by auth.onAuthStateChanged
            });
        }


        // --- Event Listeners and Auth ---

        // Form Buttons
        document.getElementById("save-btn")?.addEventListener("click", () => saveOrUpdateCredential(false));
        document.getElementById("save-btn-m")?.addEventListener("click", () => saveOrUpdateCredential(true));
        
        document.getElementById("cancel-edit-btn")?.addEventListener("click", () => cancelEdit(false));
        document.getElementById("cancel-edit-btn-m")?.addEventListener("click", () => cancelEdit(true));
        
        document.getElementById("add-custom-field-btn")?.addEventListener("click", () => addCustomField(false));
        document.getElementById("add-custom-field-btn-m")?.addEventListener("click", () => addCustomField(true));

        // Search Inputs
        document.getElementById("searchInput")?.addEventListener("input", filterPasswords);
        document.getElementById("searchInputMobile")?.addEventListener("click", openMobileSearch); 
        document.getElementById("close-search-btn")?.addEventListener("click", closeMobileSearch); 
        document.getElementById("searchInputMobileOverlay")?.addEventListener("input", filterPasswords); 


        // Mobile Menu Toggle
        document.getElementById("menu-btn")?.addEventListener("click", () => {
            document.getElementById("mobile-menu").classList.toggle("hidden");
            document.getElementById("menu-btn").querySelector('i').classList.toggle("fa-bars");
            document.getElementById("menu-btn").querySelector('i').classList.toggle("fa-times");
        });

        // Auth listener
        auth.onAuthStateChanged(user => {
            if(user){
                currentUser = user;
                // Desktop profile info update
                document.getElementById("user-name").innerText = user.displayName || "User";
                document.getElementById("user-email").innerText = user.email || "";
                document.getElementById("user-pic").src = user.photoURL || "https://via.placeholder.com/40";
                
                // Load decrypted credentials
                loadCredentials();
            } else {
                // Redirect if not logged in
                location.href = "index.html"; 
            }
        });

        // Logout buttons
        document.getElementById("logout-btn")?.addEventListener("click", handleLogout);
        document.getElementById("mobileLogout")?.addEventListener("click", handleLogout);

        // --- Other CRUD & Share Functions (Included for completeness) ---

        function deleteCredential(id){
            if(confirm("Are you sure you want to delete this credential?")){
                db.ref(`users/${currentUser.uid}/credentials/${id}`).remove();
                // Deletion triggers the loadCredentials listener to refresh the list automatically
            }
        }

        function shareCredential(encoded){
            const data = JSON.parse(decodeURIComponent(encoded));
            let text = `Website/App: ${data.title}\n`;
            if(data.link) text += `Link: ${data.link}\n`; 
            if(data.email) text += `Email: ${data.email}\n`;
            if(data.username) text += `Username: ${data.username}\n`;
            if(data.password) text += `Password: ${data.password}\n`;
            
            if (data.customFields && Object.keys(data.customFields).length > 0) {
                text += "\n--- Custom Fields ---\n";
                Object.entries(data.customFields).forEach(([label, value]) => {
                    text += `${label}: ${value}\n`;
                });
            }

            if(navigator.share){
                navigator.share({title: `Credential for ${data.title}`, text}).catch(() => alert("Sharing failed or was cancelled."));
            } else alert("Web Share API is not supported on this browser. You can manually copy the content:\n\n" + text);
        }
    </script>
 <button id="theme-toggle-btn" title="Toggle Dark/Light Mode">
    <span id="theme-icon">ðŸŒ™</span>
</button>

<style>
    /* --- 1. THEME VARIABLES --- */
    :root {
        --bg-body: #f3f4f6; 
        --bg-card: #ffffff;
        --text-main: #4b5563; 
        --text-bold: #111827; 
        --border: #e5e7eb;   
        --input-bg: #ffffff;
        --input-text: #1f2937;
        --nav-bg: #ffffff;
        --nav-text: #666666;
        --nav-hover: #007AFF; /* Modern Blue */
        --nav-height: 65px;
    }

    [data-theme="dark"] {
        --bg-body: #0f172a; 
        --bg-card: #1e293b; 
        --text-main: #cbd5e1; 
        --text-bold: #ffffff; 
        --border: #334155;   
        --input-bg: #0f172a; 
        --input-text: #ffffff;
        --nav-bg: #1e293b;
        --nav-text: #94a3b8;
        --nav-hover: #60a5fa; /* Brighter blue for dark mode */
    }

    /* --- 2. GLOBAL THEME OVERRIDES --- */
    body { 
        background-color: var(--bg-body) !important; 
        color: var(--text-main) !important; 
        transition: background 0.3s ease; 
    }

    /* Fix for SAVIG Brand Name & Headings Visibility */
    .font-black, h1, h2, h3, #form-title, #form-title-m, .website-name {
        color: var(--text-bold) !important;
        transition: color 0.3s ease;
    }

    /* Containers, Cards & Footer */
    .bg-white, #mobile-menu, footer, .password-item, .full-search-overlay, .full-search-overlay header {
        background-color: var(--bg-card) !important;
        border-color: var(--border) !important;
        color: var(--text-main) !important;
    }

    /* --- 3. CREDENTIAL CARDS (PASSWORD ITEMS) --- */
    /* --- 3. CREDENTIAL CARDS (PASSWORD ITEMS) --- */
.password-item {
    background-color: var(--bg-card) !important;
    border: 1px solid var(--border) !important; /* Ensure border is consistent */
    transition: all 0.3s ease;
}

.password-item:hover {
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

[data-theme="dark"] .password-item:hover {
    box-shadow: 0 0 15px rgba(96, 165, 250, 0.1); /* Reduced opacity glow */
    /* border-color removed from here to prevent the blue outline */
}

    /* Username & Password Values */
    .cred-value {
        color: var(--text-bold) !important;
        font-weight: 500;
    }

    /* --- 4. BOTTOM NAV & HOVER EFFECTS --- */


    /* Desktop Check: Hide bottom nav on large screens */
    @media only screen and (min-width: 768px) {
        #universal-bottom-nav, .nav-spacer { display: none !important; }
    }


    /* --- 5. FORM INPUTS & BUTTONS --- */
    input, select {
        background-color: var(--input-bg) !important;
        color: var(--input-text) !important;
        border: 0px solid var(--border) !important;
    }

    [data-theme="dark"] input::placeholder {
        color: #94a3b8 !important;
    }

    /* Add Custom Field Button Styling in Dark Mode */
    [data-theme="dark"] #add-custom-field-btn, 
    [data-theme="dark"] #add-custom-field-btn-m {
        background-color: transparent !important;
    
        color: var(--nav-hover) !important;
    }

    /* Mobile Icons (Hamburger & Back Arrow) */
    [data-theme="dark"] #menu-btn, [data-theme="dark"] #close-search-btn {
        color: var(--text-bold) !important;
    }

    /* Theme Toggle Button */
    #theme-toggle-btn {
        position: fixed;
        bottom: 85px; 
        right: 15px;
        z-index: 9999;
        width: 42px; height: 42px;
        border-radius: 50%;
        background: #4f46e5;
        color: white;
        border: none;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer;
        transition: transform 0.2s;
    }

    #theme-toggle-btn:active { transform: scale(0.9); }
    /* Specifically target the labels (Username/Password) in Dark Mode */
[data-theme="dark"] .password-item p,
[data-theme="dark"] .password-item span {
    color: var(--text-main) !important;
}

/* Ensure the dots (â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢) and actual values are bright white */
[data-theme="dark"] .cred-value {
    color: #ffffff !important;
    font-weight: 600;
}
/* Specific fix for labels and values in Dark Mode */
[data-theme="dark"] .password-item p {
    color: #94a3b8 !important; /* Lighter slate gray for the labels */
}

[data-theme="dark"] .password-item p span {
    color: #94a3b8 !important; /* Ensures the "Email:" text is readable */
}

[data-theme="dark"] .password-item .cred-value {
    color: #ffffff !important; /* Pure white for the actual decrypted values */
    font-weight: 600;
}

/* Fix for the Desktop Header Email */
[data-theme="dark"] #user-email {
    color: #94a3b8 !important;
}

[data-theme="dark"] #user-name {
    color: #ffffff !important;
}
</style>
<script>
    (function() {
        const themeBtn = document.getElementById('theme-toggle-btn');
        const themeIcon = document.getElementById('theme-icon');
        const root = document.documentElement;

        const applyTheme = (theme) => {
            root.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeIcon.textContent = (theme === 'dark') ? 'â˜€ï¸' : 'ðŸŒ™';
        };

        const savedTheme = localStorage.getItem('theme') || 
                          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        applyTheme(savedTheme);

        themeBtn.addEventListener('click', () => {
            const current = root.getAttribute('data-theme');
            applyTheme(current === 'dark' ? 'light' : 'dark');
        });
    })();
</script>

  <nav id="universal-bottom-nav">
   <a href="homemob.html" class="nav-link group flex flex-col items-center transition-all duration-300 hover:scale-110 active:scale-90">
        <i class="fa-solid fa-house transition-colors duration-300 group-hover:text-indigo-600"></i>
        <div class="transition-all duration-300 group-hover:text-indigo-600 group-hover:font-bold text-xm">Home</div>
    </a>

    <a href="addressmob.html" class="nav-link group flex flex-col items-center transition-all duration-300 hover:scale-110 active:scale-90">
        <i class="fa-solid fa-location-dot transition-colors duration-300 group-hover:text-indigo-600"></i>
        <div class="transition-all duration-300 group-hover:text-indigo-600 group-hover:font-bold">Address</div>
    </a>

    <a href="passwordmob.html" class="nav-link group flex flex-col items-center transition-all duration-300 hover:scale-110 active:scale-90">
        <i class="fa-solid fa-key transition-colors duration-300 group-hover:text-indigo-600"></i>
        <div class="transition-all duration-300 group-hover:text-indigo-600 group-hover:font-bold">Password</div>
    </a>

    <a href="contact.html" class="nav-link group flex flex-col items-center transition-all duration-300 hover:scale-110 active:scale-90">
        <i class="fa-solid fa-envelope transition-colors duration-300 group-hover:text-indigo-600"></i>
        <div class="transition-all duration-300 group-hover:text-indigo-600 group-hover:font-bold">Contact</div>
    </a>
          <a href="cr.html" class="nav-link group flex flex-col items-center transition-all duration-300 hover:scale-110 active:scale-90">
        <i class="fas fa-calendar-alt transition-colors duration-300 group-hover:text-indigo-600"></i>
        <div class="transition-all duration-300 group-hover:text-indigo-600 group-hover:font-bold">Calender</div>
    </a>
    </nav>




<style>
/* 1. Theme Variables & Reset */
:root {
    --bg-color: #ffffff;
    --nav-bg: rgba(255, 255, 255, 0.95); 
    --nav-text: #000000; /* Pure black for light mode */
    --hover-bg: #f8fafc;
    --active-color: #2563eb;
    --border-color: rgba(0, 0, 0, 0.1);
    --nav-height: 70px;
}

[data-theme='dark'] {
    --bg-color: #0f172a;
    --nav-bg: rgba(15, 23, 42, 0.98);
    --nav-text: #ffffff; /* FIXED: Changed from black to white for readability */
    --hover-bg: #1e293b;
    --active-color: #60a5fa;
    --border-color: rgba(255, 255, 255, 0.1);
}

body {
    background-color: var(--bg-color);
    transition: background-color 0.3s ease;
    min-height: 100vh;
    margin: 0;
    font-family: 'Inter', sans-serif;
    overflow-x: hidden;
    padding-bottom: 80px;
}

/* 2. Universal Bottom Nav Entrance Animation */
#universal-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background-color: var(--nav-bg);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    display: flex;
    justify-content: space-around;
    align-items: center;
    border-top: 1px solid var(--border-color);
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.1);
    z-index: 999999;
    padding-bottom: env(safe-area-inset-bottom);
    animation: navSlideUp 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    font-size: 10px;
}

@keyframes navSlideUp {
    from { transform: translateY(100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* 3. Bottom Nav Link Styling */
.nav-link {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--nav-text) !important; 
    text-decoration: none !important;
    transition: color 0.3s ease;
    position: relative;
    height: 40px;
}

.nav-link i {
    font-size: 21px;
    margin-bottom: 4px;
    color: inherit;
    /* Cleaned up stroke for better legibility */
    -webkit-text-stroke: 0.5px var(--nav-text); 
    font-weight: 700;
}

.nav-link div {
    font-size: 11px;
    font-weight: 800; /* 900 can be too chunky on some screens */
    text-transform: uppercase;
    color: inherit;
    letter-spacing: 0.02em;
    gap: 5px;
}

.nav-link.active {
    color: var(--active-color) !important;
}

.nav-link.active i {
    transform: translateY(-3px);
    -webkit-text-stroke: 0.5px var(--active-color);
}

/* 4. Top Grid Boxes Styling */
.box-container {
    width: 60px;
    height: 57px;
    border-radius: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    background: white;
    border: 1px solid var(--border-color); /* Added for definition */
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
}

[data-theme='dark'] .box-container:not(.bg-\[\#ffe11b\]) {
    background: #1e293b;
    color: #ffffff; /* Ensures text is visible in dark mode */
}

.animate-pop {
    animation: popIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    opacity: 0;
}

@keyframes popIn {
    0% { transform: scale(0.6); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

/* 5. Modern Pill Toggle Above Nav */
/* 5. Modern Pill Toggle Above Nav */
.theme-toggle {
    position: fixed;
    bottom: 100px; 
    right: 2rem;
    z-index: 10001;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    background: var(yellow);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid var(--border-color);
    color: var(--active-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.theme-toggle:hover {
    transform: translateY(-2px);
    background: var(--hover-bg);
}

/* 6. Profile Box Top Right */
.header-container {
position: fixed;

    top: 20px;

    right: 5px;

    z-index: 1000;

}






.profile-box {
    width: 30px;
    height: 30px;
    background: white;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid var(--active-color);
    transition: background-color 0.3s ease;
    margin-top: 55px;
    margin-bottom: 5px;
}

[data-theme='dark'] .profile-box { 
    background: #1e293b; 
}

/* --- Adjustments for the Top Header Area --- */
.header-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    z-index: 1000;
    background: var(--bg-color); /* Matches theme */
    box-sizing: border-box;
}

/* Grid boxes container needs to stay horizontal */
.top-grid-nav {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding-bottom: 5px;
    scrollbar-width: none; /* Hide scrollbar for clean look */
}

.top-grid-nav::-webkit-scrollbar {
    display: none;
}

/* Ensure icons in the toggle switch between moon/sun */
[data-theme='dark'] .theme-toggle .fa-sun { display: block; }
[data-theme='dark'] .theme-toggle .fa-moon { display: none; }
[data-theme='light'] .theme-toggle .fa-sun { display: none; }
[data-theme='light'] .theme-toggle .fa-moon { display: block; }

/* Logic to show moon/sun icons depending on theme (Compatibility Fallback) */
[data-theme='dark'] .theme-toggle i.fa-sun {
    display: inline-block;
}
[data-theme='light'] .theme-toggle i.fa-moon {
    display: inline-block;
}



/* 1. Reset Body and Layout Logic */
body.flex.flex-col.items-center {
    display: block !important; /* Overrides the center stacking */
    padding-top: 85px !important; /* Prevents content from being hidden */
    padding-bottom: 80px !important;
}

/* 2. Force the Nav and Profile into a Row */
nav.w-full {
    position: fixed !important;
    top: 0;
    left: 0;
    z-index: 1000;
    background: var(--bg-color);
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 10px 15px !important;
    
    font-weight: bolder;
}

/* 3. Fix the Grid Columns for Mobile */
nav .grid-cols-4 {
    display: flex !important; /* Using flex instead of grid for better row control */
    gap: 12px !important;
    margin: 0 !important;
}

/* 4. Positioning the Profile Box back to the top right */


/* 5. Data Visibility and Contrast */
.box-container {
    flex-shrink: 0 !important; /* Stops boxes from squishing */
    background: white; /* Default for light mode */
}

/* Keeps the text readable on the yellow background specifically */

/* If you want ONLY the Savig text to stay dark because the box is yellow */
[data-theme='dark'] .box-container.bg-\[\#ffe11b\] span {
    color: #000000 !important;
}
/* 6. Theme Toggle Logic (Icon Display) */
[data-theme='dark'] .theme-toggle .fa-sun { display: block !important; }
[data-theme='dark'] .theme-toggle .fa-moon { display: none !important; }
[data-theme='light'] .theme-toggle .fa-sun { display: none !important; }
[data-theme='light'] .theme-toggle .fa-moon { display: block !important; }
.universal-bottom-nav:hover{
    color: #2563eb;
}
</style>

























</body>
</html>























































