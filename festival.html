<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Important Data Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script>
        // Tailwind Configuration for a modern palette and subtle shadows
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-indigo': '#4f46e5',
                        'primary-blue': '#3b82f6',
                        'accent-blue': '#1e40af',
                    },
                    boxShadow: {
                        'custom-light': '0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.02)',
                        'custom-hover': '0 10px 15px rgba(0, 0, 0, 0.08), 0 4px 6px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar for data container */
        .data-container::-webkit-scrollbar { width: 6px; }
        .data-container::-webkit-scrollbar-thumb { background-color: #94a3b8; border-radius: 3px; }
        .data-container::-webkit-scrollbar-track { background-color: #f1f5f9; }

        /* Modern input focus style */
        input:focus, textarea:focus, select:focus {
            border-color: #4f46e5 !important;
            box-shadow: 0 0 0 1px #4f46e5 !important;
        }
        
        /* Ensures the left container scrolls independently */
        .left-container-scroll {
            max-height: calc(100vh - 120px); /* Adjusted height to fit between nav and footer area */
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pt-20 font-sans">

    <nav class="bg-white shadow-md fixed w-full z-50 top-0">
        <div class="container mx-auto flex justify-between items-center p-4 md:px-8">
            <div class="flex items-center gap-2 text-xl font-extrabold text-gray-800">
                <i class="fas fa-user-circle" style="font-size: 28px; color: #3b82f6;"></i>
                <span style="font-size: 22px;">My **Personal Data**</span>
            </div>
            
            <div class="hidden md:flex space-x-6 font-medium">
                <a href="home.html" class="nav-link"><i class="fas fa-house"></i> Home</a>
                <a href="address.html" class="nav-link nav-active"><i class="fas fa-tasks"></i> Address</a>
                <a href="birthday.html" class="nav-link"><i class="fas fa-birthday-cake"></i> Birthday</a>
                <a href="password.html" class="nav-link"><i class="fas fa-key"></i> Passwords</a>
                <a href="income.html" class="nav-link"><i class="fas fa-wallet"></i> Income</a>
                <a href="links.html" class="nav-link"><i class="fas fa-link"></i> Links</a>
                <a href="calendar.html" class="nav-link"><i class="fas fa-calendar-alt"></i> Calendar</a>
            </div>

            <div class="hidden md:flex items-center gap-4">
                <div class="text-right">
                    <p id="userName" class="font-bold text-gray-900">Loading...</p>
                    <p id="userEmail" class="text-sm text-gray-500">Loading...</p>
                </div>
                <img id="userPhoto" src="https://via.placeholder.com/40" class="w-10 h-10 rounded-full ring-2 ring-primary-blue object-cover">
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300 font-semibold shadow-md">Logout</button>
            </div>

            <button id="menu-btn" class="md:hidden text-gray-700 text-2xl"><i class="fas fa-bars"></i></button>
        </div>

        <div id="mobileMenu" class="hidden md:hidden flex flex-col px-4 pb-4 space-y-2 text-sm text-gray-700 font-medium bg-white border-t border-gray-100">
            <a href="home.html" class="mobile-nav-link"><i class="fas fa-house"></i> Home</a>
            <a href="address.html" class="mobile-nav-link text-primary-indigo font-bold bg-indigo-50"><i class="fas fa-tasks"></i> Address</a>
            <a href="birthday.html" class="mobile-nav-link"><i class="fas fa-birthday-cake"></i> Birthday</a>
            <a href="password.html" class="mobile-nav-link"><i class="fas fa-key"></i> Passwords</a>
            <a href="income.html" class="mobile-nav-link"><i class="fas fa-wallet"></i> Income</a>
            <a href="links.html" class="mobile-nav-link"><i class="fas fa-link"></i> Links</a>
            <a href="calendar.html" class="mobile-nav-link"><i class="fas fa-calendar-alt"></i> Calendar</a>
            <div class="border-t border-gray-300 mt-2 pt-2">
                <p id="mobileUserName" class="font-bold text-gray-900">Loading...</p>
                <p id="mobileUserEmail" class="text-xs text-gray-500">Loading...</p>
                <button onclick="logout()" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 mt-2 w-full font-semibold">Logout</button>
            </div>
        </div>
    </nav>

    <style>
        .nav-link {
            display: flex; align-items: center; gap: 8px; transition: all 0.2s ease-in-out; 
            color: #4b5563; /* Gray-600 */
            font-size: 16px;
            padding: 4px 0;
        }
        .nav-link:hover {
            color: #3b82f6; /* Primary Blue */
            transform: translateY(-2px);
            font-weight: 600;
        }
        .nav-active {
            color: #4f46e5; /* Primary Indigo (active) */
            font-weight: 700;
            border-bottom: 2px solid #4f46e5;
        }
        .mobile-nav-link {
            display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px; 
            transition: background-color 0.2s;
        }
        .mobile-nav-link:hover {
            background-color: #eef2ff; /* Indigo-50 */
            color: #4f46e5;
        }
        .form-input {
            width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; 
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.06); 
            transition: all 0.2s ease-in-out;
            color: #374151; /* Gray-700 */
        }
         .action-btn {
            display: flex; align-items: center; gap: 6px; font-size: 14px; 
            padding: 6px 12px; border-radius: 9999px; /* Pill shape */
            transition: all 0.2s; font-weight: 600;
        }
        .action-btn:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
    </style>
    <main class="container mx-auto p-4 md:px-8 mt-4">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-8 border-b-2 pb-3">
            <i class="fas fa-calendar-check mr-2 text-primary-blue"></i> Important Dates & Data
        </h1>
        
        <div class="flex flex-col lg:flex-row gap-8">
            
            <div class="w-full lg:w-1/3 xl:w-1/4 bg-white p-6 rounded-xl shadow-custom-light border border-gray-100 left-container-scroll">
                <h2 class="text-2xl font-bold text-primary-indigo mb-6 border-b pb-2">New Entry</h2>
                <form id="dataEntryForm" class="space-y-5">
                    
                    <div>
                        <label for="dataTitle" class="block text-sm font-semibold text-gray-700 mb-1">Title</label>
                        <input type="text" id="dataTitle" required class="form-input">
                    </div>

                    <div>
                        <label for="dataDate" class="block text-sm font-semibold text-gray-700 mb-1">Date</label>
                        <input type="date" id="dataDate" required class="form-input">
                    </div>
                    
                    <div>
                        <label for="dataNotes" class="block text-sm font-semibold text-gray-700 mb-1">Notes</label>
                        <textarea id="dataNotes" rows="4" class="form-input"></textarea>
                    </div>

                    <h3 class="text-lg font-bold text-gray-700 pt-4 border-t mt-4">Notification</h3>
                    <div>
                        <label for="notifyType" class="block text-sm font-medium text-gray-700 mb-1">Notify Me:</label>
                        <select id="notifyType" required class="form-input">
                            <option value="none">No Notification</option>
                            <option value="days">After Some Days</option>
                            <option value="months">After Some Months</option>
                            <option value="yearly">Every Year (Annually)</option>
                        </select>
                    </div>

                    <div id="notifyValueContainer" class="hidden">
                        <label for="notifyValue" class="block text-sm font-medium text-gray-700 mb-1">Number of Days/Months</label>
                        <input type="number" id="notifyValue" min="1" class="form-input">
                    </div>
                    
                    <button type="submit" id="saveButton" class="w-full bg-primary-blue text-white py-3 px-4 rounded-lg hover:bg-accent-blue transition duration-300 font-bold text-lg shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                        <i class="fas fa-plus-circle"></i> Save Entry
                    </button>
                </form>
            </div>
            
            <div class="flex-1">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Saved Important Items</h2>
                
                <div id="dataList" class="space-y-4 data-container max-h-[80vh] lg:max-h-[calc(100vh-160px)] overflow-y-auto pr-2">
                    <p id="loadingMessage" class="text-gray-500 text-center py-8 text-lg"><i class="fas fa-spinner fa-spin mr-2"></i> Loading data...</p>
                </div>
            </div>
            
        </div>
    </main>
    

    <div id="editModal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg transform scale-100 transition-transform duration-300">
            <h3 class="text-2xl font-bold text-primary-indigo mb-6 border-b pb-2">Edit Data Entry</h3>
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editKey">
                <div>
                    <label for="editTitle" class="block text-sm font-semibold text-gray-700 mb-1">Title</label>
                    <input type="text" id="editTitle" required class="form-input">
                </div>
                <div>
                    <label for="editDate" class="block text-sm font-semibold text-gray-700 mb-1">Date</label>
                    <input type="date" id="editDate" required class="form-input">
                </div>
                <div>
                    <label for="editNotes" class="block text-sm font-semibold text-gray-700 mb-1">Notes</label>
                    <textarea id="editNotes" rows="4" class="form-input"></textarea>
                </div>
                
                <h3 class="text-lg font-bold text-gray-700 pt-4 border-t mt-4">Notification Settings</h3>
                <div>
                    <label for="editNotifyType" class="block text-sm font-medium text-gray-700 mb-1">Notify Me:</label>
                    <select id="editNotifyType" required class="form-input">
                        <option value="none">No Notification</option>
                        <option value="days">After Some Days</option>
                        <option value="months">After Some Months</option>
                        <option value="yearly">Every Year (Annually)</option>
                    </select>
                </div>
                <div id="editNotifyValueContainer" class="hidden">
                    <label for="editNotifyValue" class="block text-sm font-medium text-gray-700 mb-1">Number of Days/Months</label>
                    <input type="number" id="editNotifyValue" min="1" class="form-input">
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeEditModal()" class="px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-semibold">Cancel</button>
                    <button type="submit" class="px-5 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="bg-white text-gray-600 text-center py-4 text-sm mt-10 border-t border-gray-100 shadow-inner">
        &copy; 2025 My Personal Website | All Rights Reserved.
    </footer>
    <script>
    // -------------------------------------------------------------------
    // 1. FIREBASE CONFIGURATION (YOUR KEYS INTEGRATED)
    // -------------------------------------------------------------------
    const firebaseConfig = {
        apiKey: "AIzaSyB78RTVCg0cmSPp7A1RJyyAgBuCeolO0cc",
        authDomain: "sk12-58e9e.firebaseapp.com",
        databaseURL: "https://sk12-58e9e-default-rtdb.firebaseio.com",
        projectId: "sk12-58e9e",
        storageBucket: "sk12-58e9e.appspot.com",
        messagingSenderId: "470207874652",
        appId: "1:470207874652:web:67ba1cf3629b7e5b144899"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const auth = firebase.auth();

    let currentUserID = "test_user_id"; // Placeholder, will be replaced by auth
    const dataList = document.getElementById('dataList');
    const loadingMessage = document.getElementById('loadingMessage');
    const notifyTypeSelect = document.getElementById('notifyType');
    const notifyValueContainer = document.getElementById('notifyValueContainer');
    const editNotifyTypeSelect = document.getElementById('editNotifyType');
    const editNotifyValueContainer = document.getElementById('editNotifyValueContainer');
    const editModal = document.getElementById('editModal');

    // -------------------------------------------------------------------
    // 2. AUTHENTICATION AND DATA PATH SETUP
    // -------------------------------------------------------------------

    auth.onAuthStateChanged(user => {
        if (user) {
            currentUserID = user.uid;
            document.getElementById('userName').textContent = user.displayName || 'User';
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('mobileUserName').textContent = user.displayName || 'User';
            document.getElementById('mobileUserEmail').textContent = user.email;
            if (user.photoURL) {
                document.getElementById('userPhoto').src = user.photoURL;
            }
            listenForDataChanges();
        } else {
            // Fallback for non-authenticated users (you may want to redirect to a login page)
            currentUserID = "anonymous_demo_user";
            listenForDataChanges();
        }
    });

    function logout() {
        auth.signOut().then(() => {
            // Optionally redirect to login page
        }).catch((error) => {
            console.error("Logout Error:", error);
        });
    }

    // -------------------------------------------------------------------
    // 3. UI HELPER FUNCTIONS
    // -------------------------------------------------------------------

    document.getElementById('menu-btn').addEventListener('click', () => {
        document.getElementById('mobileMenu').classList.toggle('hidden');
    });

    // Handle visibility and label update for notification value
    const updateNotifyValueUI = (typeSelect, valueContainer) => {
        const isCustom = typeSelect.value === 'days' || typeSelect.value === 'months';
        valueContainer.classList.toggle('hidden', !isCustom);
        const valueInput = valueContainer.querySelector('input');
        valueInput.required = isCustom;
        valueInput.previousElementSibling.textContent = typeSelect.value === 'days' ? 'Number of Days' : 'Number of Months';
    };

    notifyTypeSelect.addEventListener('change', () => updateNotifyValueUI(notifyTypeSelect, notifyValueContainer));
    editNotifyTypeSelect.addEventListener('change', () => updateNotifyValueUI(editNotifyTypeSelect, editNotifyValueContainer));
    
    // -------------------------------------------------------------------
    // 4. CRUD OPERATIONS (CREATE, READ, UPDATE, DELETE)
    // -------------------------------------------------------------------

    // CREATE (Save Data)
    document.getElementById('dataEntryForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const title = document.getElementById('dataTitle').value;
        const date = document.getElementById('dataDate').value;
        const notes = document.getElementById('dataNotes').value;
        const notifyType = notifyTypeSelect.value;
        const notifyValue = (notifyType === 'days' || notifyType === 'months') ? document.getElementById('notifyValue').value : null;

        if (!currentUserID) return alert("User not authenticated.");

        const newData = {
            title: title,
            date: date,
            notes: notes,
            notify: {
                type: notifyType,
                value: notifyValue
            },
            timestamp: firebase.database.ServerValue.TIMESTAMP
        };

        const newKey = database.ref('users/' + currentUserID + '/imp-data').push().key;

        database.ref('users/' + currentUserID + '/imp-data/' + newKey).set(newData)
            .then(() => {
                document.getElementById('dataEntryForm').reset();
                notifyValueContainer.classList.add('hidden');
            })
            .catch(error => {
                console.error("Error saving data: ", error);
                alert('Failed to save data: ' + error.message);
            });
    });

    // READ (Real-time Listener)
    function listenForDataChanges() {
        if (!currentUserID) return;

        const dataRef = database.ref('users/' + currentUserID + '/imp-data').orderByChild('date');

        dataRef.on('value', (snapshot) => {
            dataList.innerHTML = '';
            loadingMessage.classList.add('hidden');

            if (!snapshot.exists()) {
                dataList.innerHTML = '<div class="text-gray-500 bg-white p-6 rounded-xl shadow-custom-light text-center border border-gray-100"><i class="fas fa-box-open mr-2"></i> **No important data saved yet.** Use the form on the left to add your first item.</div>';
                return;
            }

            snapshot.forEach((childSnapshot) => {
                const key = childSnapshot.key;
                const data = childSnapshot.val();
                renderDataItem(key, data);
            });
        }, (error) => {
            console.error("Error fetching data:", error);
            dataList.innerHTML = '<p class="text-red-500 text-center py-4 font-semibold">Error loading data.</p>';
        });
    }

    // UPDATE (Edit Data)
    function openEditModal(key, data) {
        document.getElementById('editKey').value = key;
        document.getElementById('editTitle').value = data.title;
        document.getElementById('editDate').value = data.date;
        document.getElementById('editNotes').value = data.notes;
        
        editNotifyTypeSelect.value = data.notify.type;
        document.getElementById('editNotifyValue').value = data.notify.value || '';
        
        editNotifyTypeSelect.dispatchEvent(new Event('change'));

        editModal.classList.remove('hidden');
        editModal.classList.add('flex');
    }

    function closeEditModal() {
        editModal.classList.add('hidden');
        editModal.classList.remove('flex');
    }

    document.getElementById('editForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const key = document.getElementById('editKey').value;
        const title = document.getElementById('editTitle').value;
        const date = document.getElementById('editDate').value;
        const notes = document.getElementById('editNotes').value;
        const notifyType = document.getElementById('editNotifyType').value;
        const notifyValue = (notifyType === 'days' || notifyType === 'months') ? document.getElementById('editNotifyValue').value : null;

        if (!currentUserID || !key) return;

        const updatedData = {
            title: title,
            date: date,
            notes: notes,
            notify: {
                type: notifyType,
                value: notifyValue
            }
        };

        database.ref('users/' + currentUserID + '/imp-data/' + key).update(updatedData)
            .then(() => {
                closeEditModal();
            })
            .catch(error => {
                console.error("Error updating data: ", error);
                alert('Failed to update data: ' + error.message);
            });
    });

    // DELETE
    function deleteData(key) {
        if (!currentUserID || !key) return;
        if (confirm("Are you sure you want to permanently delete this item?")) {
            database.ref('users/' + currentUserID + '/imp-data/' + key).remove()
                .then(() => {
                    // Item deleted
                })
                .catch(error => {
                    console.error("Error deleting data: ", error);
                    alert('Failed to delete item: ' + error.message);
                });
        }
    }

    // SHARE (Basic Copy to Clipboard)
    function shareData(data) {
        const shareText = `ðŸ“Œ Important Data: ${data.title}\nðŸ“… Date: ${data.date}\nðŸ“ Notes: ${data.notes}\nðŸ”” Notification: ${formatNotification(data.notify)}`;
        navigator.clipboard.writeText(shareText).then(() => {
            alert('Item details copied to clipboard!');
        }).catch(err => {
            console.error('Could not copy text: ', err);
            alert('Failed to copy. Please copy manually.');
        });
    }

    // -------------------------------------------------------------------
    // 5. RENDERING AND FORMATTING
    // -------------------------------------------------------------------

    function formatNotification(notify) {
        if (!notify || notify.type === 'none') {
            return 'None (No reminder)';
        }
        if (notify.type === 'yearly') {
            return 'Annual Reminder (Every Year)';
        }
        if (notify.type === 'days' || notify.type === 'months') {
            const unit = notify.value > 1 ? notify.type : notify.type.slice(0, -1);
            return `After ${notify.value} ${unit}`;
        }
        return 'Custom';
    }

    function renderDataItem(key, data) {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'bg-white p-6 rounded-xl shadow-custom-light border-l-4 border-primary-blue transition duration-300 hover:shadow-custom-hover hover:-translate-y-1 transform';
        
        // Escape single quotes for use in onclick functions
        const jsonString = JSON.stringify(data).replace(/'/g, '&#39;');

        itemDiv.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <h3 class="text-xl font-bold text-gray-900">${data.title}</h3>
                <span class="text-sm font-semibold bg-blue-100 text-primary-blue px-3 py-1 rounded-full border border-blue-200">${data.date}</span>
            </div>
            
            <p class="text-gray-700 whitespace-pre-wrap mb-4 border-b border-gray-100 pb-4">${data.notes}</p>
            
            <div class="text-sm text-gray-500 mb-4 pt-2 flex items-center gap-4">
                <span class="font-bold text-gray-800"><i class="fas fa-bell mr-2 text-yellow-600"></i> Reminder:</span>
                <span>${formatNotification(data.notify)}</span>
            </div>
            
            <div class="flex flex-wrap gap-3 justify-end pt-2">
                <button onclick="openEditModal('${key}', ${jsonString})" class="action-btn text-blue-600 hover:bg-blue-50">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button onclick="deleteData('${key}')" class="action-btn text-red-600 hover:bg-red-50">
                    <i class="fas fa-trash-alt"></i> Delete
                </button>
                <button onclick="shareData(${jsonString})" class="action-btn text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        `;

        dataList.appendChild(itemDiv);
    }
</script>

</body>
</html>