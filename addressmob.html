<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savig</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

   <style>
    /* --- 1. BASE STYLES & ANIMATIONS --- */
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .spinner {
        animation: spin 1s linear infinite;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8fafc; /* Tailwind gray-50 */
        padding-top: 5rem; /* Standard space for fixed nav */
        transition: padding 0.3s ease;
    }

    /* --- 2. ADDRESS LIST & EDITING STATES --- */
    .address-item {
        transition: all 0.3s ease;
    }

    /* Dim other items when editing one */
    #addressList.editing .address-item {
        opacity: 0.3;
        pointer-events: none;
    }

    #addressList.editing .address-item.is-editing {
        opacity: 1;
        pointer-events: auto;
        transform: scale(1.02);
        border-color: greenyellow;
        box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.2);
    }

    /* Prevent iOS zoom on input focus */
    input, textarea {
        font-size: 16px !important;
    }


    /* --- 3. MOBILE STYLES (Below 768px) --- */
    @media (max-width: 767px) {
        /* Mobile Search Overlay Logic */
        body.search-active {
            overflow: hidden; /* Prevent background from scrolling */
            padding-top: 0;
        }

        /* HIDE UI ELEMENTS IN SEARCH MODE */
        body.search-active .left-container,
        body.search-active .right-container h2,
        body.search-active footer {
            display: none !important;
        }

        /* PIN SEARCH BAR EXACTLY BELOW NAV (56px is standard height) */
        body.search-active #searchWrapper {
            position: fixed;
            top: 56px; 
            left: 0;
            width: 100%;
            z-index: 100;
            background: white;
            padding: 10px 16px;
            margin: 0 !important;
            border-bottom: 1px solid #e5e7eb;
            display: flex !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* SCROLLABLE RESULTS AREA */
        body.search-active .right-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #f8fafc;
            z-index: 40;
            /* Pushes list down: Nav (56px) + Search (approx 60px) + Buffer */
            padding-top: 125px !important; 
            overflow-y: auto;
        }

        /* Improved readability for mobile address details */
        .address-item p.text-sm {
            font-size: 15px;
            line-height: 1.5;
        }
    }

    /* --- 4. DESKTOP STYLES (768px and up) --- */
    @media (min-width: 768px) {
        /* Desktop Search remains in flow, no fixed positioning */
        #searchWrapper {
            position: relative;
            top: auto;
        }

        #addressList {
            height: 450px; /* Fixed height for scrollable container */
            overflow-y: auto;
            padding-right: 8px;
        }

        /* Custom Scrollbar */
        #addressList::-webkit-scrollbar {
            width: 6px;
        }
        #addressList::-webkit-scrollbar-thumb {
            background-color: #e2e8f0;
            border-radius: 10px;
        }

        /* Increased detail font size for desktop */
        .right-container .address-item .text-sm {
            font-size: 18px; 
            color: #036f09; /* gray-600 */
        }

        /* Sidebar Form Sticky Position */
        .left-container {
            position: sticky;
            top: 6rem;
        }
    }
/* --- LAPTOP OPTIMIZATIONS --- */
@media (min-width: 768px) {
    /* Set the best professional background */
    body {
        background-color: #f8fafc; /* bg-slate-50 */
    }

    /* Professional Desktop detail size */
    .right-container .address-item .text-sm {
        font-size: 18px !important;
        color: #334155; /* Slate 700 */
    }

    /* Button Hover Depth */
    .address-item button:hover, .address-item a:hover {
        transform: translateY(-1px);
        filter: brightness(90%);
    }
    a[href*="google.com/maps"] {
        border-color: #e2e8f0;
        color: #475569; /* slate-600 */
    }
    
    a[href*="google.com/maps"]:hover {
        background-color: #f1f5f9; /* slate-100 */
        border-color: #cbd5e1;
    }
}
@media (max-width: 767px) {
    /* Force hide the universal bottom nav when search is active */
    body.search-active #universal-bottom-nav {
        display: none !important;
    }
}
/* Apply this to your global stylesheet */

/* Apply this to your global stylesheet */
html, body {
  height: 100%;
  margin: 0;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* This ensures the main content grows to fill available space */
main, .content-wrapper {
  flex: 1;
}

/* This ensures the main content grows to fill available space */

</style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <div>
<div id="searchWrapper" class="flex items-center gap-1 mb-1 ml-[25px] w-[280px] h-[60px] transition-all duration-300 overflow-hidden">
    <button id="backBtn" onclick="toggleMobileSearchFocus(false)" class="hidden text-gray-600 text-xl p-2 hover:bg-gray-100 rounded-full transition">
        <i class="fas fa-arrow-left"></i>
    </button>
    
    <input type="text" id="searchInput" placeholder="Search..." 
            class="flex-grow p-3 border border-gray-300 rounded-lg outline-none transition shadow-sm text-lg 
                   hover:border-amber-400 focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
            oninput="filterAddresses()"
            onfocus="toggleMobileSearchFocus(true)" />
</div></div>
<div class="max-w-8xl mx-auto px-4 mt-6">
    <button id="toggleFormBtn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">
        + Add New Address
    </button>
</div>

<div class="max-w-8xl mx-auto px-4 py-[14px] md:px-[30px] md:py-[30px] grid md:grid-cols-2 gap-5 -mt-[9px]">

    <div id="addressForm" class="hidden bg-white p-6 rounded-xl shadow-lg h-fit md:sticky md:top-24 left-container">
        <div class="flex justify-between items-center mb-2 border-b pb-2">
            <h2 class="text-2xl font-bold text-indigo-700">‚ûï Save New Address</h2>
            
        </div>
        
        <div class="space-y-4">
            <div>
                <label for="placeInput" class="block text-sm font-medium text-gray-700 mb-1">Place Name (e.g., Home, Office)</label>
                <input type="text" id="placeInput" placeholder="Enter place name..." 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition" />
            </div>

            <div>
                <label for="landmarkInput" class="block text-sm font-medium text-gray-700 mb-1">Landmark / Details</label>
                <textarea id="landmarkInput" placeholder="Enter building number, street..." rows="2"
                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition resize-y"></textarea>
            </div>

            <div>
                <label for="mapInput" class="block text-sm font-medium text-gray-700 mb-1">Google Map Location (Optional)</label>
                <input type="url" id="mapInput" placeholder="Paste Google Maps URL..." 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition mb-2" />
                
                <a href="https://www.google.com/maps" target="_blank" 
                   class="w-full flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50 transition duration-300 font-medium text-sm shadow-sm">
                    <img src="https://www.gstatic.com/images/branding/product/1x/maps_96dp.png" alt="Google Maps" class="w-5 h-5">
                    Find Location on Google Maps
                </a>
            </div>

            <button id="saveAddressBtn" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition duration-300 flex items-center justify-center shadow-md">
                <i class="fas fa-save mr-2"></i> Save Address
            </button>
        </div>
    </div>

   

   
    <div class="right-container">
        <h2 class="text-2xl font-bold mb-4 text-indigo-700">üè† Your Saved Addresses</h2>
   

        <div id="addressList" class="space-y-4">
             <div id="loadingIndicator" class="text-center p-10 text-gray-500">
                <i class="fas fa-sync fa-2x spinner text-indigo-500 mb-3"></i>
                <div class="text-center p-10 text-gray-400">
                    <i class="fas fa-map-marked-alt fa-3x mb-3"></i>
                    <p>Your saved locations will appear here.</p>
                </div>
            </div>
        </div>
    </div>
</div>
<nav id="universal-bottom-nav" style="position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background-color: var(--nav-bg); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 999999; font-family: sans-serif;">

    <a href="homemob.html" class="nav-link" style="text-decoration: none; color: var(--nav-text); text-align: center; flex: 1; -webkit-tap-highlight-color: transparent;">
        <i class="fa-solid fa-house" style="font-size: 18px; display: block; margin-bottom: 3px;"></i>
        <div style="font-size: 10px; font-weight: 600;">Home</div>
    </a>

    <a href="addressmob.html" class="nav-link" style="text-decoration: none; color: var(--nav-text); text-align: center; flex: 1; -webkit-tap-highlight-color: transparent;">
        <i class="fa-solid fa-location-dot" style="font-size: 18px; display: block; margin-bottom: 3px;"></i>
        <div style="font-size: 10px; font-weight: 600;">Address</div>
    </a>

    <a href="passwordmob.html" class="nav-link" style="text-decoration: none; color: var(--nav-text); text-align: center; flex: 1; -webkit-tap-highlight-color: transparent;">
        <i class="fa-solid fa-key" style="font-size: 18px; display: block; margin-bottom: 3px;"></i>
        <div style="font-size: 10px; font-weight: 600;">Passwords</div>
    </a>

    <a href="grocerymob.html" class="nav-link" style="text-decoration: none; color: var(--nav-text); text-align: center; flex: 1; -webkit-tap-highlight-color: transparent;">
        <i class="fa-solid fa-cart-shopping" style="font-size: 18px; display: block; margin-bottom: 3px;"></i>
        <div style="font-size: 10px; font-weight: 600;">Grocery</div>
    </a>

    <a href="contact.html" class="nav-link" style="text-decoration: none; color: var(--nav-text); text-align: center; flex: 1; -webkit-tap-highlight-color: transparent;">
        <i class="fa-solid fa-envelope" style="font-size: 18px; display: block; margin-bottom: 3px;"></i>
        <div style="font-size: 10px; font-weight: 600;">Contact</div>
    </a>

</nav>

<style>
    /* ... Your existing CSS ... */

    :root {
        --nav-bg: #ffffff;
        --nav-text: #000000;
        --nav-hover: #007AFF;
        --input-bg: #ffffff;
        --input-text: #1f2937;
        --placeholder-color: #9ca3af;
        --border-color: #e5e7eb;
    }

    /* --- DARK MODE OVERRIDES --- */
    [data-theme="dark"] {
        --nav-bg: #111827; /* Match your screenshot's dark sidebar */
        --nav-text: #f3f4f6;
        --nav-hover: #3b82f6;
        --input-bg: #1f2937; /* Lighter than body for contrast */
        --input-text: #ffffff;
        --placeholder-color: #9ca3af;
        --border-color: #374151;
    }

    /* Apply to Mobile Nav */
    #universal-bottom-nav {
        background-color: var(--nav-bg) !important;
        color: var(--nav-text) !important;
        border-top: 1px solid var(--border-color);
    }

    /* Apply to Search Bars & Inputs */
    input, textarea {
        background-color: var(--input-bg) !important;
        color: var(--input-text) !important;
        border: 1px solid var(--border-color) !important;
    }

    /* Target Search Placeholders specifically */
    input::placeholder, textarea::placeholder {
        color: var(--placeholder-color) !important;
        opacity: 1; /* Firefox fix */
    }

    /* Desktop Nav Adjustments for Dark Mode */
    [data-theme="dark"] nav.bg-white {
        background-color: var(--nav-bg) !important;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }
    
    [data-theme="dark"] #mobileMenu {
        background-color: var(--nav-bg) !important;
    }
</style>


<div class="nav-spacer" style="height: 75px; width: 100%;"></div>
  <script>
        // --- FIREBASE CONFIGURATION (Keep as is) ---
        var firebaseConfig = {
            apiKey: "AIzaSyB78RTVCg0cmSPp7A1RJyyAgBuCeolO0cc",
            authDomain: "sk12-58e9e.firebaseapp.com",
            databaseURL: "https://sk12-58e9e-default-rtdb.firebaseio.com",
            projectId: "sk12-58e9e",
            storageBucket: "sk12-58e9e.appspot.com",
            messagingSenderId: "470207874652",
            appId: "1:470207874652:web:67ba1cf3629b7e5b144899"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        // --- GLOBAL VARIABLES & UI ELEMENTS ---
        let allAddresses = []; 
        const addressListEl = document.getElementById("addressList");
        const menuBtn = document.getElementById("menu-btn");
        const mobileMenu = document.getElementById("mobileMenu");
        const searchInputEl = document.getElementById("searchInput");

        // --- HELPER FUNCTION: Capitalize first letter of each word ---
        function capitalizeWords(str) {
            if (!str) return '';
            return str.toLowerCase().split(' ').map(word => {
                if (word.length === 0) return '';
                return word.charAt(0).toUpperCase() + word.slice(1);
            }).join(' ');
        }

        // === MOBILE FOCUS LOGIC ===
        function toggleMobileSearchFocus(isFocused) {
            if (window.innerWidth < 768) {
                document.body.classList.toggle('search-active', isFocused);
                
                if (!isFocused && searchInputEl.value.trim() === '') {
                    setTimeout(() => document.body.classList.remove('search-active'), 100); 
                }
            }
        }
        // ==============================
        
        // --- UI EVENT LISTENERS ---
        document.getElementById("saveAddressBtn").addEventListener("click", saveAddress);
        
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- AUTHENTICATION STATE & UI UPDATE ---
     firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
        const name = user.displayName || "User";
        const email = user.email;
        const photo = user.photoURL || "https://via.placeholder.com/40";

        const elements = {
            "userName": name,
            "mobileUserName": name,
            "userEmail": email,
            "mobileUserEmail": email
        };

        // Update Text Elements
        for (let id in elements) {
            let el = document.getElementById(id);
            if (el) el.innerText = elements[id];
        }

        // Update All Photo Elements (Desktop & Mobile)
        // This finds every image with the id "userPhoto" or similar classes
        document.querySelectorAll('img[id*="userPhoto"]').forEach(img => {
            img.src = photo;
        });

        loadAddresses(user.uid);
    } else {
        window.location.href = "indexmob.html";
    }
});
        
        function logout() {
            firebase.auth().signOut().then(() => window.location.href = "indexmob.html");
        }

        // --- CRUD FUNCTIONS ---

        function saveAddress() {
            const user = firebase.auth().currentUser;
            if (!user || !user.uid) {
                console.error("User not logged in or UID missing. Cannot save data.");
                alert("Error: Please Log In Again To Save Data.");
                return;
            }
            
            const place = document.getElementById("placeInput").value.trim();
            const landmark = document.getElementById("landmarkInput").value.trim();
            const mapLink = document.getElementById("mapInput").value.trim();
            
            if (!place || !landmark) {
                alert("Please Fill Both Place Name And Landmark/Details.");
                return;
            }

            const newRef = firebase.database().ref("addresses/" + user.uid).push();
            newRef.set({
                id: newRef.key,
                place: capitalizeWords(place), 
                landmark: capitalizeWords(landmark),
                mapLink: mapLink, 
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                // Clear all input fields
                document.getElementById("placeInput").value = "";
                document.getElementById("landmarkInput").value = "";
                document.getElementById("mapInput").value = "";
                
            }).catch(error => {
                console.error("Error Saving Address: ", error);
                alert("Failed To Save Address. Check Console For Details.");
            });
        }

        function loadAddresses(uid) {
            firebase.database().ref("addresses/" + uid).on("value", (snapshot) => {
                allAddresses = [];
                snapshot.forEach((child) => {
                    allAddresses.push(child.val());
                });
                filterAddresses(); 
            });
        }
        
        // --- NEW FUNCTION: Toggle Edit Form ---
        
    
 function toggleEditForm(id) {
            const form = document.getElementById(`edit-form-${id}`);
            const itemContainer = form ? form.closest('.address-item') : null; 
            const displayView = document.getElementById(`display-view-${id}`);

            if (form && itemContainer && displayView) {
                form.classList.toggle('hidden'); 
                
                const isFormVisible = !form.classList.contains('hidden');

                displayView.classList.toggle('hidden', isFormVisible);
                addressListEl.classList.toggle('editing', isFormVisible);
                itemContainer.classList.toggle('is-editing', isFormVisible);
                searchInputEl.classList.toggle('hidden', isFormVisible);

                if (isFormVisible) {
                    const data = allAddresses.find(item => item.id === id);
                    if (data) {
                         document.getElementById(`edit-place-${id}`).value = data.place;
                         document.getElementById(`edit-landmark-${id}`).value = data.landmark;
                         document.getElementById(`edit-map-${id}`).value = data.mapLink || '';
                    }

                    itemContainer.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest'
                    });
                }
            }
        }

        function saveEditedAddress(id) {
            const user = firebase.auth().currentUser;
            if (!user) return;

            const newPlace = document.getElementById(`edit-place-${id}`).value.trim();
            const newLandmark = document.getElementById(`edit-landmark-${id}`).value.trim();
            const newMapLink = document.getElementById(`edit-map-${id}`).value.trim();

            if (!newPlace || !newLandmark) {
                alert("Place Name And Landmark Cannot Be Empty.");
                return;
            }

            // --- FIX: Ensure the edit form is hidden before the Firebase call ---
            const editForm = document.getElementById(`edit-form-${id}`);
            const itemContainer = editForm.closest('.address-item'); 
            const displayView = document.getElementById(`display-view-${id}`);
            
            // Hide the edit form and show the display view (it will be refreshed by Firebase)
            editForm.classList.add('hidden');
            displayView.classList.remove('hidden'); 

            // Reset global editing state
            addressListEl.classList.remove('editing');
            itemContainer.classList.remove('is-editing');
            searchInputEl.classList.remove('hidden');
            // ---------------------------------------------------------------------


            firebase.database().ref("addresses/" + user.uid + "/" + id).update({
                place: capitalizeWords(newPlace),
                landmark: capitalizeWords(newLandmark),
                mapLink: newMapLink
            }).then(() => {
                // Success: The listener will now automatically re-render the list with updated data.
                
            }).catch(error => {
                console.error("Update Failed:", error);
                alert("Failed to save changes. Check console for details.");
                
                // If it fails, restore the edit form view manually
                const editForm = document.getElementById(`edit-form-${id}`);
                const displayView = document.getElementById(`display-view-${id}`);
                
                if (displayView && editForm) {
                    editForm.classList.remove('hidden'); 
                    displayView.classList.add('hidden'); 
                }
                
                addressListEl.classList.add('editing');
                itemContainer.classList.add('is-editing');
                searchInputEl.classList.add('hidden'); 
            });
        }

        function deleteAddress(uid, id) {
            if (confirm("Are You Sure You Want To Permanently Delete This Address?")) {
                firebase.database().ref("addresses/" + uid + "/" + id).remove()
                    .catch(error => console.error("Deletion Failed:", error));
            }
        }
function shareAddress(place, landmark, mapLink, method = 'system') {
    let text = `Check Out This Address:\n*Place:* ${place}\n*Details:* ${landmark}`;
    if (mapLink) {
        text += `\n*Map Link:* ${mapLink}`;
    }

    if (method === 'whatsapp') {
        // Direct protocol 'whatsapp://' opens the app immediately bypassing the browser landing page
        const whatsappAppUrl = `whatsapp://send?text=${encodeURIComponent(text)}`;
        window.location.href = whatsappAppUrl;
    } else {
        // Standard System Share for all other options (Email, Teams, etc.)
        if (navigator.share) {
            navigator.share({
                title: `Address: ${place}`,
                text: text,
            }).catch(error => console.log('Error sharing', error));
        } else {
            navigator.clipboard.writeText(text).then(() => alert('Copied to clipboard!'));
        }
    }
}
        // --- FILTERING & RENDERING (Renders full details always) ---
          function displayFilteredAddresses(dataList) {
    addressListEl.innerHTML = "";

    if (dataList.length === 0) {
        addressListEl.innerHTML = '<div class="text-center p-6 text-gray-500 bg-gray-100 rounded-lg">No Addresses Found Matching Your Search.</div>';
        return;
    }

    dataList.forEach((data) => {
        const uid = firebase.auth().currentUser.uid;
        const div = document.createElement("div");
        div.id = `item-${data.id}`;
        div.className = "address-item bg-white p-4 border border-gray-200 rounded-xl shadow-md hover:shadow-lg transition duration-300";

        const mapButtonHTML = data.mapLink ? `
            <a href="${data.mapLink}" target="_blank" class="bg-indigo-500 text-white px-3 py-1 rounded-full hover:bg-indigo-600 transition text-sm flex items-center">
                <i class="fas fa-map-marker-alt mr-1"></i> View Map
            </a>` : '';

        div.innerHTML = `
            <div id="display-view-${data.id}" class="">
                <div class="flex justify-between items-start">
                    <div class="flex-grow">
                        <p class="text-lg font-bold text-gray-800">${data.place}</p>
                        <p class="text-sm text-gray-600 whitespace-pre-wrap">${data.landmark}</p>
                    </div>
                </div>
                <div class="flex flex-wrap justify-end gap-2 mt-3"> 
                    ${mapButtonHTML}
                    
                    <button class="bg-orange-500 text-white px-3 py-1 rounded-full hover:bg-green-700 transition text-sm flex items-center" 
                            onclick="shareAddress('${data.place}', '${data.landmark}', '${data.mapLink || ''}', 'whatsapp')">
                        <i class="fab fa-whatsapp mr-1"></i> WhatsApp
                    </button>

                    <button class="bg-blue-500 text-white px-3 py-1 rounded-full hover:bg-blue-600 transition text-sm flex items-center" 
                            onclick="shareAddress('${data.place}', '${data.landmark}', '${data.mapLink || ''}', 'system')">
                        <i class="fas fa-share-alt mr-1"></i> Share
                    </button>

                    <button class="bg-yellow-500 text-white px-3 py-1 rounded-full hover:bg-yellow-600 transition text-sm flex items-center" 
                            onclick="toggleEditForm('${data.id}')">
                        <i class="fas fa-edit mr-1"></i> Edit
                    </button>
                    <button class="bg-purple-500 text-white px-3 py-1 rounded-full hover:bg-red-600 transition text-sm flex items-center" 
                            onclick="deleteAddress('${uid}', '${data.id}')">
                        <i class="fas fa-trash-alt mr-1"></i> Delete
                    </button>
                </div>
            </div>
            <div id="edit-form-${data.id}" class="hidden space-y-3 pt-3 border-t mt-3">
                <h4 class="font-bold text-gray-700">Editing: ${data.place}</h4>
                <label class="block text-xs font-medium text-gray-500">Place Name</label>
                <input type="text" id="edit-place-${data.id}" value="${data.place}" class="w-full p-2 border border-gray-300 rounded-lg text-sm" />
                <label class="block text-xs font-medium text-gray-500">Details</label>
                <textarea id="edit-landmark-${data.id}" rows="2" class="w-full p-2 border border-gray-300 rounded-lg text-sm">${data.landmark}</textarea>
                <label class="block text-xs font-medium text-gray-500">Map Link</label>
                <input type="url" id="edit-map-${data.id}" value="${data.mapLink || ''}" class="w-full p-2 border border-gray-300 rounded-lg text-sm" />
                <div class="flex justify-end gap-2 mt-3">
                    <button class="bg-green-500 text-white px-3 py-1 rounded-full text-sm" onclick="saveEditedAddress('${data.id}')">Save</button>
                    <button class="bg-gray-500 text-white px-3 py-1 rounded-full text-sm" onclick="toggleEditForm('${data.id}')">Cancel</button>
                </div>
            </div>
        `;
        addressListEl.appendChild(div);
    });
}

  function filterAddresses() {
            if (!addressListEl.classList.contains('editing')) {
                const query = document.getElementById("searchInput").value.toLowerCase();
                const filtered = allAddresses.filter(item =>
                    item.place.toLowerCase().includes(query) || item.landmark.toLowerCase().includes(query)
                );
                displayFilteredAddresses(filtered);
            }
        }
function toggleMobileSearchFocus(isFocused) {
    const searchWrapper = document.getElementById("searchWrapper");
    const backBtn = document.getElementById("backBtn");
    const leftContainer = document.querySelector(".left-container");
    const rightHeader = document.querySelector(".right-container h2");
    const navBar = document.querySelector("nav");

    if (window.innerWidth < 768) {
        document.body.classList.toggle('search-active', isFocused);

        if (isFocused) {
            // Hide everything else
            if (leftContainer) leftContainer.classList.add("hidden");
            if (rightHeader) rightHeader.classList.add("hidden");
            if (navBar) navBar.classList.add("hidden");

            // Pin search bar to top
            searchWrapper.classList.add("fixed", "top-0", "left-0", "w-full", "z-50", "p-3", "shadow-md");
            backBtn.classList.remove("hidden");
        } else {
            // Restore UI
            if (leftContainer) leftContainer.classList.remove("hidden");
            if (rightHeader) rightHeader.classList.remove("hidden");
            if (navBar) navBar.classList.remove("hidden");

            searchWrapper.classList.remove("fixed", "top-0", "left-0", "w-full", "z-50", "p-3", "shadow-md");
            backBtn.classList.add("hidden");
            
            searchInputEl.value = ""; 
            filterAddresses();
        }
    }
}
    </script>
    <script>
document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('theme-toggle-btn');
    const icon = document.getElementById('theme-icon');
    
    // 1. Load saved theme immediately on page load
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    icon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

    // 2. Click Event
    btn.addEventListener('click', () => {
        let currentTheme = document.documentElement.getAttribute('data-theme');
        let newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        // Apply new theme
        document.documentElement.setAttribute('data-theme', newTheme);
        
        // Save to LocalStorage (works across all pages on your site)
        localStorage.setItem('theme', newTheme);
        
        // Update Icon
        icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    });
});
</script>
     <button id="theme-toggle-btn">
    <span id="theme-icon">üåô</span>
</button>
<style>
    /* --- 1. THEME VARIABLE DEFINITIONS --- */
    :root {
        --bg-body: #f9fafb;
        --bg-card: #ffffff;
        --text-main: #1f2937;   /* Deep Gray 800 */
        --text-bold: #000000;   /* Pure Black */
        --border: #e5e7eb;
        
        /* BOTTOM NAV COLORS (LIGHT) */
        --nav-bg: #ffffff;
        --nav-text: #000000;    /* Pure Black for text and icons */
        --nav-height: 65px;
    }

    [data-theme="dark"] {
        --bg-body: #0f172a;     /* Deep Navy/Black */
        --bg-card: #1e293b;     /* Slate 800 */
        --text-main: #cbd5e1;   /* Slate 300 */
        --text-bold: #f8fafc;   /* Slate 50 */
        --border: #334155;      /* Slate 700 */
        
        /* BOTTOM NAV COLORS (DARK) */
        --nav-bg: #0f172a;
        --nav-text: #ffffff;    /* Pure White */
    }

    /* --- 2. GLOBAL OVERRIDES --- */
    body { background-color: var(--bg-body) !important; color: var(--text-main) !important; transition: background 0.3s; }
    
    /* Ensure all text classes inside containers adapt */
    h1, h2, h3, h4, .font-bold, .font-semibold, 
    .text-gray-900, .text-gray-800, .text-blue-800, .text-green-800, .text-yellow-800 { 
        color: var(--text-bold) !important; 
    }

    p, li, span, .text-gray-700, .text-gray-600 { 
        color: var(--text-main) !important; 
    }

    /* Component Surfaces */
    .bg-white, header, aside, main, #mobile-menu, footer {
        background-color: var(--bg-card) !important;
        border-color: var(--border) !important;
    }

    /* --- 3. SIDEBAR & CORE FEATURES FIXES --- */
    [data-theme="dark"] .sidebar-desktop, [data-theme="dark"] aside {
        background-color: var(--bg-card) !important;
    }
    
    /* Muted Sidebar links in dark mode */
    [data-theme="dark"] .sidebar-nav-internal a { color: #94a3b8 !important; }
    [data-theme="dark"] .sidebar-nav-internal a:hover,
    [data-theme="dark"] .sidebar-nav-internal a.active {
        background-color: #334155 !important;
        color: #60a5fa !important;
    }

    /* Core Features Overview Boxes */
    [data-theme="dark"] .bg-gray-100, 
    [data-theme="dark"] .bg-yellow-50,
    [data-theme="dark"] .bg-blue-50,
    [data-theme="dark"] .bg-green-50 {
        background-color: #334155 !important;
        border-color: var(--border) !important;
    }

    /* Brighter borders for boxes in dark mode */
    [data-theme="dark"] .border-l-4, [data-theme="dark"] .border-t-4 {
        border-color: #4f46e5 !important; 
    }

    /* --- 4. BOTTOM NAV (DARKER FONTS & ICONS) --- */
    #universal-bottom-nav {
        background-color: var(--nav-bg) !important;
        border-top: 1px solid var(--border) !important;
        height: var(--nav-height);
        color:white;
    }

    /* This targets the icon specifically */
    .nav-link i { 
        color: var(--nav-text) !important; 
        font-weight: 900 !important; /* Makes icons look thicker/bolder */
        font-size: 20px !important;  /* Slightly larger for visibility */
        transition: transform 0.2s;
    }

    /* This targets the text label specifically */
    .nav-link div { 
        color: var(--nav-text) !important; 
        font-weight: 900 !important; /* Thickest weight for labels */
        font-size: 11px !important;
        margin-top: 2px;
    }

    /* --- 5. THEME TOGGLE (50px ABOVE NAV) --- */
    #theme-toggle-btn {
        position: fixed;
        bottom: 85px; /* 65px height + 50px gap */
        right: 5px;
        z-index: 10000;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: none;
        background: #4f46e5;
        color: white;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    #theme-toggle-btn:active { transform: scale(0.9); }
    /* Ensure fixed search wrapper respects dark mode */
[data-theme="dark"] #searchWrapper.fixed {
    background-color: #111827 !important; /* Deep Navy to match your UI */
    border-bottom: 1px solid #374151;
}

/* Ensure the input inside the fixed wrapper stays dark */
[data-theme="dark"] #searchWrapper input {
    background-color: #1f2937 !important;
    color: white !important;
}

/* Style the placeholder specifically for better visibility */
[data-theme="dark"] input::placeholder {
    color: #9ca3af !important;
}
</style>
<style>
@media (max-width: 767px) {
    /* 1. Remove the body's top padding so search bar touches the top edge */
    body.search-active {
        padding-top: 0 !important;
        overflow: hidden;
        background-color: var(--bg-body) !important;
    }

    /* 2. Hide all Nav and Footer elements */
    body.search-active nav, 
    body.search-active #universal-bottom-nav, 
    body.search-active .nav-spacer {
        display: none !important;
    }

    /* 3. Pin Search Bar to top 0 */
    body.search-active #searchWrapper {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 10px 16px !important;
        z-index: 100 !important;
        background-color: var(--bg-card) !important;
        display: flex !important;
    }

    /* 4. Results container covers full screen with theme background */
    body.search-active .right-container {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100vh !important;
        background-color: var(--bg-body) !important;
        z-index: 40 !important;
        padding-top: 80px !important; /* Space to see results below bar */
        overflow-y: auto;
    }
}
body.search-active {
        padding-top: 0 !important;
        overflow: hidden;
    }

    body.search-active nav, 
    body.search-active #universal-bottom-nav, 
    body.search-active .nav-spacer {
        display: none !important;
    }

    body.search-active #searchWrapper {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 10px 16px !important;
        z-index: 100 !important;
        display: flex !important;
    }

    /* Full dark background for search results */
    [data-theme="dark"] body.search-active,
    [data-theme="dark"] body.search-active .right-container {
        background-color: #0f172a !important; /* Your deep dark color */
        position: fixed;
        inset: 0;
        z-index: 40;
        padding-top: 80px !important;
        overflow-y: auto;
    }

</style>
<script>
    const toggleBtn = document.getElementById('toggleFormBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const addressForm = document.getElementById('addressForm');

    // Show form when "Add New Address" is clicked
    toggleBtn.addEventListener('click', () => {
        addressForm.classList.toggle('hidden');
        
        // Change button text based on state
        if (addressForm.classList.contains('hidden')) {
            toggleBtn.innerText = '+ Add New Address';
        } else {
            toggleBtn.innerText = 'Close Form';
        }
    });

    // Hide form when "Cancel" is clicked
    cancelBtn.addEventListener('click', () => {
        addressForm.classList.add('hidden');
        toggleBtn.innerText = '+ Add New Address';
    });
</script>
<div id="fabOverlay" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200 z-[998]"></div>

<div id="fabContainer" class="fixed bottom-20 left-2 z-[999] flex flex-col-reverse items-start">
    
    <button id="fabTrigger" class="pulse w-11 h-11 bg-blue-600 text-white rounded-xl shadow-lg flex items-center justify-center transition-all duration-200 active:scale-90 z-50">
        <i id="fabIcon" class="fas fa-th-large text-base"></i>
    </button>

    <div id="fabMenu" class="flex flex-col-reverse gap-3 mb-4 pointer-events-none">
               <a href="index.html" onclick="instantNav(event, 'index.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-cyan-600 group-hover:bg-cyan-600 group-hover:text-white">
                <i class="fa-solid fa-right-from-bracket" text-xs"></i>
            </div>
            <span class="menu-label">Logout</span>
        </a>
        <a href="added.html" onclick="instantNav(event, 'added.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-slate-500 group-hover:bg-slate-800 group-hover:text-white">
                <i class="fas fa-cog text-xs"></i>
            </div>
            <span class="menu-label">Settings</span>
        </a>

        <a href="principle.html" onclick="instantNav(event, 'principle.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-orange-500 group-hover:bg-orange-500 group-hover:text-white">
                <i class="fas fa-lightbulb text-xs"></i>
            </div>
            <span class="menu-label">Principles</span>
        </a>

        <a href="daily.html" onclick="instantNav(event, 'daily.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-indigo-600 group-hover:bg-indigo-600 group-hover:text-white">
                <i class="fas fa-tasks text-xs"></i>
            </div>
            <span class="menu-label">Daily Tasks</span>
        </a>

        <a href="cr.html" onclick="instantNav(event, 'cr.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-red-500 group-hover:bg-red-500 group-hover:text-white">
                <i class="fa-solid fa-calendar-alt text-xs"></i>
            </div>
            <span class="menu-label">Calender</span>
        </a>

        <a href="asset.html" onclick="instantNav(event, 'asset.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-emerald-600 group-hover:bg-emerald-600 group-hover:text-white">
                <i class="fas fa-wallet text-xs"></i>
            </div>
            <span class="menu-label">Assets</span>
        </a>

        <a href="Links.html" onclick="instantNav(event, 'link.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-blue-500 group-hover:bg-blue-500 group-hover:text-white">
                <i class="fa-solid fa-link text-xs"></i>
            </div>
            <span class="menu-label">Links</span>
        </a>

        <a href="essential.html" onclick="instantNav(event, 'essential.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-pink-500 group-hover:bg-pink-500 group-hover:text-white">
                <i class="fas fa-shopping-basket text-xs"></i>
            </div>
            <span class="menu-label">Essentials</span>
        </a>

        <a href="profile.html" onclick="instantNav(event, 'profile.html')" class="menu-item group flex items-center gap-3">
            <div class="icon-box text-cyan-600 group-hover:bg-cyan-600 group-hover:text-white">
                <i class="fas fa-user text-xs"></i>
            </div>
            <span class="menu-label">Profile</span>
        </a>
       
        
    </div>
</div>

<style>
    /* BASE ITEM STYLES */
    .menu-item {
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.2s cubic-bezier(0, 0, 0.2, 1);
    }

    .icon-box {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        background: white;
        box-shadow: 0 10px 15px -3px rgba(60, 35, 112, 0.1);
        border: 1px solid #e5e7eb;
        flex-shrink: 0;
    }

    /* FIX: Names visibility in Light Mode */
    .menu-label {
        font-size: 11px;
        font-weight: 800;
        padding: 5px 5px;
        border-radius: 8px;
        background: #f8fafc; /* Very light background for contrast */
        color: #1e293b;      /* Deep dark text for light mode */
        white-space: nowrap;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
    }

    /* FIX: Names visibility in Dark Mode */
    [data-theme="dark"] .icon-box { background: #1e293b; border-color: #334155; }
    [data-theme="dark"] .menu-label { 
        background: #334155; 
        color: #f8fafc; /* Bright text for dark mode */
        border: 1px solid rgba(255,255,255,0.1); 
    }

    .menu-active .menu-item { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .overlay-active { opacity: 1 !important; pointer-events: auto !important; }

    @keyframes pulse-blue {
        0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(37, 99, 235, 0); }
        100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
    }
    .pulse { animation: pulse-blue 2s infinite; }
</style>

<script>
    const trigger = document.getElementById('fabTrigger');
    const container = document.getElementById('fabContainer');
    const icon = document.getElementById('fabIcon');
    const overlay = document.getElementById('fabOverlay');

    function toggleMenu() {
        const isActive = container.classList.toggle('menu-active');
        overlay.classList.toggle('overlay-active');
        
        if(isActive) {
            icon.className = 'fas fa-times text-base transition-all duration-200';
            trigger.classList.replace('bg-blue-600', 'bg-slate-800');
            trigger.classList.remove('pulse');
        } else {
            icon.className = 'fas fa-th-large text-base transition-all duration-200';
            trigger.classList.replace('bg-slate-800', 'bg-blue-600');
            trigger.classList.add('pulse');
        }
    }

    function instantNav(event, url) {
        event.preventDefault();
        window.location.replace(url); // Instant jump
    }

    trigger.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMenu();
    });

    document.addEventListener('click', (e) => {
        if (container.classList.contains('menu-active') && !container.contains(e.target)) {
            toggleMenu();
        }
    });
</script>
</body>
</html>




































































































