<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Guiding Principles - Personal Website</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Custom Styles */
        .text-modern-blue { color: #4f46e5; }
        .bg-modern-blue { background-color: #4f46e5; }
        .hover\:bg-modern-blue-dark:hover { background-color: #3b30d3; } 
        .border-modern-blue { border-color: #4f46e5; }
        body { padding-top: 70px; background-color: #f7f9fb; }
        @media (min-width: 1024px) {
            .h-fit { height: fit-content; }
            .lg\:sticky { position: sticky; }
            .top-20 { top: 80px; }
        }
        /* Style for the active editing state to ensure smooth transition */
        .principle-item.editing {
            outline: 2px solid #4f46e5;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
            transition: all 0.3s ease;
        }
        /* Larger, more prominent action buttons */
        .actions button {
            font-size: 1rem; 
            padding: 0.25rem 0.5rem; 
        }

        /* --- PRINT STYLES (for clean PDF output) --- */
        @media print {
            body { 
                padding-top: 0; 
                background-color: white; 
            }
            /* Hide navigation, forms, and buttons */
            nav, #add-section, #print-button-container, .actions, .border-b, .fa-hand-sparkles {
                display: none !important;
            }
            /* Adjust content width and remove shadows/borders for print */
            main {
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            .lg\:w-2\/3 {
                width: 100% !important;
            }
            .principle-item {
                border: 1px solid #ccc;
                padding: 1rem !important;
                margin-bottom: 1rem;
                box-shadow: none !important;
            }
            /* Ensure titles are black and readable */
            h1, h2, h3, p {
                color: black !important;
            }
            /* Restore visibility for the main title */
            .print-title {
                display: block !important;
                text-align: center;
                margin-bottom: 1rem;
                font-size: 24pt;
                font-weight: bold;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-white shadow-lg fixed w-full z-50 top-0">
        <div class="container mx-auto flex justify-between items-center p-4 md:px-8">
            <div class="flex items-center gap-2 text-xl font-bold text-gray-800">
                <i class="fas fa-user-circle" style="font-size: 28px; color: #4f46e5;"></i>
                <span style="font-size: 22px;">My Personal Website</span>
            </div>
            
            <div class="hidden md:flex space-x-6 text-gray-600 font-medium">
                <a href="home.html" class="flex items-center gap-2 transition duration-300 hover:text-blue-500 hover:-translate-y-0.5" style="font-size: 18px;"><i class="fas fa-house"></i> Home</a>
                <a href="address.html" class="flex items-center gap-2 transition duration-300 hover:text-blue-500 hover:-translate-y-0.5" style="font-size: 18px;"><i class="fas fa-tasks"></i> Address</a>
                <a href="password.html" class="flex items-center gap-2 transition duration-300 hover:text-blue-500 hover:-translate-y-0.5" style="font-size: 18px;"><i class="fas fa-key"></i> Passwords</a>
                <a href="income.html" class="flex items-center gap-2 transition duration-300 hover:text-blue-500 hover:-translate-y-0.5" style="font-size: 18px;"><i class="fas fa-wallet"></i> Income</a>
                <a href="links.html" class="flex items-center gap-2 transition duration-300 hover:text-blue-500 hover:-translate-y-0.5" style="font-size: 18px;"><i class="fas fa-link"></i> Links</a>
                <a href="calendar.html" class="flex items-center gap-2 transition duration-300 hover:text-blue-500 hover:-translate-y-0.5" style="font-size: 18px;"><i class="fas fa-calendar-alt"></i> Calendar</a>
               
            </div>
            
            <div class="hidden md:flex items-center gap-4" id="user-info-section">
                <div class="text-right">
                    <p id="userName" class="font-bold text-gray-900">Loading...</p>
                    <p id="userEmail" class="text-sm text-gray-500">_</p>
                </div>
                <img id="userPhoto" src="https://via.placeholder.com/40" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #4f46e5;">
                
                <button id="authButton" onclick="handleAuth()" class="bg-modern-blue text-white px-4 py-2 rounded-full hover:bg-indigo-700 transition duration-300 font-semibold">Login</button>
            </div>
            <button id="menu-btn" class="md:hidden text-gray-700 text-2xl"><i class="fas fa-bars"></i></button>
        </div>
        
        <div id="mobileMenu" class="hidden md:hidden"></div>
    </nav>
    
    <main class="flex-grow container mx-auto p-4 md:px-8 py-10">
        <h1 class="print-title text-4xl font-extrabold text-gray-900 text-center mb-10 flex items-center justify-center gap-3">
            <i class="fas fa-hand-sparkles text-modern-blue"></i> My Guiding Principles
        </h1>

        <div class="flex flex-col lg:flex-row gap-8">
            
            <section id="add-section" class="lg:w-1/3 bg-white p-6 rounded-xl shadow-lg h-fit lg:sticky top-20">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3">‚úçÔ∏è Add a New Principle</h2>
                
                <form id="add-principle-form" class="space-y-4">
                    <div>
                        <label for="principle-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                        <input type="text" id="principle-title" placeholder="e.g., Embrace Continuous Learning" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-modern-blue focus:border-modern-blue transition duration-200">
                    </div>
                    <div>
                        <label for="principle-description" class="block text-sm font-medium text-gray-700 mb-1">Description (Optional)</label>
                        <textarea id="principle-description" placeholder="A detailed explanation of why this principle is important..." rows="6" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-modern-blue focus:border-modern-blue transition duration-200"></textarea>
                    </div>
                    <button type="submit" id="add-principle-btn" class="w-full bg-modern-blue text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition duration-300 font-semibold shadow-md flex items-center justify-center gap-2">
                        <i class="fas fa-plus"></i> Save Principle
                    </button>
                </form>
            </section>

            <section id="list-section" class="lg:w-2/3">
                <div class="flex justify-between items-center mb-6 border-b pb-3">
                    <h2 class="text-2xl font-semibold text-gray-800">üìú Current Principles</h2>
                    <div id="print-button-container">
                        <button onclick="printPrinciples()" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition duration-300 font-semibold flex items-center gap-2">
                            <i class="fas fa-print"></i> Print/PDF
                        </button>
                    </div>
                </div>
                
                <div id="principles-list" class="space-y-6">
                    <p class="text-gray-500 p-4 bg-white rounded-lg shadow-sm">Loading principles...</p>
                </div>
            </section>
        </div>
    </main>

    <footer class="mt-auto bg-white text-gray-600 text-center p-4 border-t text-sm border-t border-gray-200">
        &copy; 2025 Personal Website | All rights reserved
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script> 

   <script>
    // ===============================================
    // 1. FIREBASE INITIALIZATION & AUTH SETUP
    // ===============================================

    const firebaseConfig = {
        apiKey: "AIzaSyB78RTVCg0cmSPp7A1RJyyAgBuCeolO0cc",
        authDomain: "sk12-58e9e.firebaseapp.com",
        projectId: "sk12-58e9e",
        storageBucket: "sk12-58e9e.appspot.com",
        messagingSenderId: "470207874652",
        appId: "1:470207874652:web:67ba1cf3629b7e5b144899",
        databaseURL: "https://sk12-58e9e-default-rtdb.firebaseio.com"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

    const database = firebase.database();
    const auth = firebase.auth();
    const googleProvider = new firebase.auth.GoogleAuthProvider();

    let principlesRef = null;
    let editingState = { key: null, originalTitle: '', originalDescription: '' };

    const addForm = document.getElementById('add-principle-form');
    const titleInput = document.getElementById('principle-title');
    const descriptionInput = document.getElementById('principle-description');
    const listElement = document.getElementById('principles-list');
    const userNameElement = document.getElementById('userName');
    const userEmailElement = document.getElementById('userEmail');
    const userPhotoElement = document.getElementById('userPhoto');
    const authButton = document.getElementById('authButton');
    const printButtonContainer = document.getElementById('print-button-container');

    // ===============================================
    // 2. AUTHENTICATION HANDLERS
    // ===============================================
    function updateUI(user) {
        if (user) {
            userNameElement.textContent = user.displayName || 'User Name';
            userEmailElement.textContent = user.email || 'No email';
            userPhotoElement.src = user.photoURL || 'https://via.placeholder.com/40';
            authButton.textContent = 'Logout';
            authButton.classList.replace('bg-modern-blue', 'bg-red-500');

            principlesRef = database.ref(`principles/${user.uid}`);
            fetchPrinciples();
            addForm.style.pointerEvents = 'auto';
            document.getElementById('add-principle-btn').disabled = false;
            printButtonContainer.style.display = 'block';
        } else {
            userNameElement.textContent = 'Guest User';
            userEmailElement.textContent = 'Sign In Required';
            userPhotoElement.src = 'https://via.placeholder.com/40';
            authButton.textContent = 'Login with Google';
            authButton.classList.replace('bg-red-500', 'bg-modern-blue');

            principlesRef = null;
            listElement.innerHTML =
                '<p class="text-red-500 p-4 bg-red-50 rounded-xl shadow-sm border-l-4 border-red-400">Please log in to manage your principles.</p>';
            addForm.style.pointerEvents = 'none';
            document.getElementById('add-principle-btn').disabled = true;
            printButtonContainer.style.display = 'none';
        }
    }

    window.handleAuth = function () {
        if (auth.currentUser) {
            auth.signOut().catch((error) => console.error('Logout error:', error));
        } else {
            auth.signInWithPopup(googleProvider).catch((error) =>
                alert(`Login Failed: ${error.message}`)
            );
        }
    };

    auth.onAuthStateChanged(updateUI);

    // ===============================================
    // 3. CRUD OPERATIONS
    // ===============================================

    // ADD
    addForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (!principlesRef || !titleInput.value.trim())
            return alert('Please enter a title.');

        principlesRef
            .push({
                title: titleInput.value.trim(),
                description: descriptionInput.value.trim(),
                createdAt: firebase.database.ServerValue.TIMESTAMP,
            })
            .then(() => addForm.reset());
    });

    // DELETE
    function deletePrinciple(key) {
        if (!principlesRef) return;
        if (confirm('Are you sure you want to delete this principle?')) {
            principlesRef.child(key).remove();
        }
    }

    // EDIT
    function editPrinciple(key) {
        if (editingState.key)
            return alert(
                'Please save or cancel the currently open principle before editing another.'
            );

        const item = document.getElementById('principle-' + key);
        const titleElem = item.querySelector('.principle-title');
        const descElem = item.querySelector('.principle-description');
        const actionsDiv = item.querySelector('.actions');

        editingState = {
            key,
            originalTitle: titleElem.textContent.replace(/^\d+\.\s*/, '').trim(),
            originalDescription: descElem.textContent.trim(),
        };

        item.classList.add('editing');

        // Turn into input/textarea
        titleElem.innerHTML = `<input type="text" id="edit-title-${key}" value="${editingState.originalTitle.replace(
            /"/g,
            '&quot;'
        )}" class="w-full p-2 border border-blue-400 rounded-md focus:ring-blue-500 focus:border-blue-500">`;

        descElem.innerHTML = `<textarea id="edit-description-${key}" rows="4" class="w-full p-2 border border-blue-400 rounded-md focus:ring-blue-500 focus:border-blue-500">${editingState.originalDescription}</textarea>`;

        // Change actions to Save / Cancel
        actionsDiv.innerHTML = `
            <button data-action="save" data-key="${key}" class="text-green-600 hover:text-green-800 font-bold transition duration-150">
                <i class="fas fa-save"></i> Save
            </button>
            <button data-action="cancel" data-key="${key}" class="text-gray-600 hover:text-gray-800 transition duration-150">
                <i class="fas fa-times"></i> Cancel
            </button>
        `;
    }

    // SAVE
    function savePrinciple(key) {
        if (!principlesRef || editingState.key !== key) return;
        const titleInputElem = document.getElementById(`edit-title-${key}`);
        const descriptionInputElem = document.getElementById(`edit-description-${key}`);

        const newTitle = titleInputElem ? titleInputElem.value.trim() : '';
        const newDescription = descriptionInputElem ? descriptionInputElem.value.trim() : '';

        if (!newTitle) return alert('Title cannot be empty.');

        principlesRef
            .child(key)
            .update({ title: newTitle, description: newDescription })
            .then(() => {
                editingState = { key: null, originalTitle: '', originalDescription: '' };
                fetchPrinciples(); // Refresh immediately
            })
            .catch((error) => console.error('Error updating principle: ', error));
    }

    // CANCEL
    function cancelEdit(key) {
        if (editingState.key !== key) return;
        editingState = { key: null, originalTitle: '', originalDescription: '' };
        fetchPrinciples(); // Restore list to original
    }

    // SHARE
    function sharePrinciple(title, description) {
        const trimmedDescription = description ? description.trim() : '';
        const shareText =
            trimmedDescription.length > 0
                ? `My Principle: "${title}"\n\nDetails: ${trimmedDescription}`
                : `My Guiding Principle: "${title}"`;

        if (navigator.share) {
            navigator.share({ title, text: shareText }).catch(() => {});
        } else {
            navigator.clipboard
                .writeText(shareText)
                .then(() => alert('Principle copied to clipboard!'))
                .catch(() => alert('Copy failed.'));
        }
    }

    // PRINT
    window.printPrinciples = function () {
        window.print();
    };

    // ACTIONS HTML
    function generateActionsHtml(key, title, description) {
        const safeTitle = title.replace(/'/g, "\\'").replace(/"/g, '&quot;');
        const safeDesc = description.replace(/'/g, "\\'").replace(/"/g, '&quot;');
        return `
            <button data-action="edit" data-key="${key}" data-title="${safeTitle}" data-desc="${safeDesc}" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-edit"></i> Edit
            </button>
            <button data-action="delete" data-key="${key}" class="text-red-600 hover:text-red-800">
                <i class="fas fa-trash-alt"></i> Delete
            </button>
            <button data-action="share" data-key="${key}" data-title="${safeTitle}" data-desc="${safeDesc}" class="text-green-600 hover:text-green-800">
                <i class="fas fa-share-alt"></i> Share
            </button>
        `;
    }

    // ===============================================
    // 4. REAL-TIME DATA DISPLAY
    // ===============================================
    function fetchPrinciples() {
        if (!principlesRef) return;
        principlesRef.off('value');

        principlesRef.on('value', (snapshot) => {
            if (editingState.key) return;

            listElement.innerHTML = '';
            if (!snapshot.exists()) {
                listElement.innerHTML = `<p class="text-gray-500 bg-white rounded-xl p-4 border-l-4 border-gray-300">No principles added yet.</p>`;
                return;
            }

            const data = snapshot.val();
            const sortedKeys = Object.keys(data).sort(
                (a, b) => (data[b].createdAt || 0) - (data[a].createdAt || 0)
            );

            let principleCount = 0;

            sortedKeys.forEach((key) => {
                principleCount++;
                const { title = '', description = '' } = data[key];

                const div = document.createElement('div');
                div.id = `principle-${key}`;
                div.className =
                    'principle-item bg-white p-5 rounded-xl shadow-md border-l-4 border-modern-blue mb-3';

                const numberedTitle = `${principleCount}. ${title}`;

                div.innerHTML = `
                    <h3 class="principle-title text-xl font-bold text-gray-900 mb-2">${numberedTitle}</h3>
                    <p class="principle-description text-gray-700 mb-4 whitespace-pre-wrap">${description}</p>
                    <div class="actions flex gap-4 text-sm font-medium border-t pt-3 mt-3">
                        ${generateActionsHtml(key, title, description)}
                    </div>
                `;
                listElement.appendChild(div);
            });
        });
    }

    // ===============================================
    // 5. EVENT DELEGATION (WORKING VERSION)
    // ===============================================
    listElement.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;

        e.preventDefault();
        e.stopPropagation();

        const action = btn.dataset.action;
        const key = btn.dataset.key;
        const title = btn.dataset.title;
        const desc = btn.dataset.desc;

        if (
            editingState.key &&
            key !== editingState.key &&
            (action === 'edit' || action === 'delete')
        ) {
            alert('Save or cancel the current edit first.');
            return;
        }

        switch (action) {
            case 'edit':
                editPrinciple(key);
                break;
            case 'save':
                savePrinciple(key);
                break;
            case 'cancel':
                cancelEdit(key);
                break;
            case 'delete':
                deletePrinciple(key);
                break;
            case 'share':
                sharePrinciple(title, desc);
                break;
        }
    });
</script>

</body>
</html>